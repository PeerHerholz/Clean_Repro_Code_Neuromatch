
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Code testing &#8212; Code formatting &amp; testing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/myfile.css?v=3437f865" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'materials/code_form_test_CI/code_testing';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Course prerequisites" href="../../prerequisites.html" />
    <link rel="prev" title="Code formatting, styling and linting" href="code_formatting.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="https://impact-scholars.neuromatch.io/_static/Sciencematch.png" class="logo__image only-light" alt="Code formatting & testing - Home"/>
    <img src="https://impact-scholars.neuromatch.io/_static/Sciencematch.png" class="logo__image only-dark pst-js-only" alt="Code formatting & testing - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CoC.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dei.html">Diversity, Equity and Inclusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Setup</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="overview_code_form_test.html">Code formatting and testing</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="code_formatting.html">Code formatting, styling and linting</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Code testing</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../prerequisites.html">Course prerequisites</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../prerequisites/intro_to_shell.html">Introduction to the (unix) command line: bash</a></li>












<li class="toctree-l2"><a class="reference internal" href="../prerequisites/intro_python.html">Introduction to Python</a></li>


</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/peerherholz/Clean_Repro_Code_Neuromatch" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/peerherholz/Clean_Repro_Code_Neuromatch/issues/new?title=Issue%20on%20page%20%2Fmaterials/code_form_test_CI/code_testing.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/materials/code_form_test_CI/code_testing.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Code testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mistakes-made-while-coding">Mistakes made while coding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-instabilities-and-changes">Code instabilities and changes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-time-and-effort">save time and effort</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-confidence">long-term confidence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peace-of-mind">peace of mind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-code-from-the-start">better code from the start</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#research-software">Research software</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-tests-any-tests">Write Tests - Any Tests!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-tests">Run the tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consider-how-long-it-takes-your-tests-to-run">Consider how long it takes your tests to run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#document-the-tests-and-how-to-run-them">Document the tests and how to run them</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-realistic-cases">Test Realistic Cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-testing-framework">Use a Testing Framework</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coverage">Coverage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-test-doubles-stubs-mocking-where-appropriate">Use test doubles/stubs/mocking where appropriate</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-testing-the-basics">Code Testing - the basics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assert-a-test-s-best-friend">Assert - a test’s best friend</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax">Syntax</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A simple example</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-in-testing">Usage in Testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-testing">Runtime testing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-runtime-testing">Advantages of runtime testing:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-runtime-testing">Disadvantages of runtime testing:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-frameworks">Testing frameworks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-of-testing-frameworks">Key Features of Testing Frameworks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-for-using-testing-frameworks">Setup for using testing frameworks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pytest"><code class="docutils literal notranslate"><span class="pre">pytest</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#running-pytest">Running pytest</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-basic-tests-with-pytest">Writing Basic Tests with <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-fixtures-for-setup-and-teardown">Using Fixtures for Setup and Teardown</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameterizing-tests">Parameterizing Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-testing-different-types-of-tests">Code testing - different types of tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoke-tests">Smoke tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests">Unit tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-testing-tips">Unit Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-tests">Integration tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-testing-approaches">Integration Testing Approaches</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-testing-tips">Integration Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-tests">System tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#system-testing-tips">System Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acceptance-and-regression-tests">Acceptance and regression tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acceptance-testing">Acceptance testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-testing">Regression testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion:</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="code-testing">
<h1>Code testing<a class="headerlink" href="#code-testing" title="Link to this heading">#</a></h1>
<img align="center" src="https://uploads-ssl.webflow.com/5f3c19f18169b62a0d0bf387/60d33beacf4ba7263a23cd79_qh6ImC4NPdyPbvn-7ns8FYsgOskDPDWLnX31mLCOgSwpX_SQgmo8krqdg4e6XAnSbqRAtZMYqlf7UTvlHiXgt5YtMwbt9IRY1fAbOjyq5hARui-xEQUgI48EOjhJGuIsSFDg90L6.jpeg" alt="logo" title="jupyter" width="400" height="700" /> 
<p>Looking back at our <a class="reference external" href="https://github.com/PeerHerholz/Clean_Repro_Code_Neuromatch/blob/main/workshop/materials/code_form_test_CI/emd_clust_cont_loss_sim.py">script</a> from the section before, ie the one you just brought up to code concerning <code class="docutils literal notranslate"><span class="pre">comments</span></code> and <code class="docutils literal notranslate"><span class="pre">formatting</span></code> based on <code class="docutils literal notranslate"><span class="pre">guidelines</span></code>, there is at least one other big question we have to address…</p>
<p>How do we know that the <code class="docutils literal notranslate"><span class="pre">code</span></code> does what it is supposed to be doing?</p>
<p>Now you might think “What do you mean? It is running the things I wrote down, done.”. However, the reality looks different…</p>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Generally, there are two major reasons why it is of the utmost importance to check and evaluate <code class="docutils literal notranslate"><span class="pre">code</span></code>:</p>
<ol class="arabic simple">
<li><p><strong>Mistakes made while coding</strong></p></li>
<li><p><strong>Code instability and changes</strong></p></li>
</ol>
<p>Let’s have a quick look at both.</p>
<section id="mistakes-made-while-coding">
<h3>Mistakes made while coding<a class="headerlink" href="#mistakes-made-while-coding" title="Link to this heading">#</a></h3>
<p>It is very, very easy to make mistakes when <code class="docutils literal notranslate"><span class="pre">coding</span></code>. A single misplaced character can cause a program/script’s output to be entirely wrong or vary tremendously from what its expected behavior. This can happen because a plus sign which should have been a minus or one piece of code working in one unit  while a piece of code written by another researcher worked in a differnt unit. Everyone makes mistakes, but the results can be catastrophic. Careers can be damaged/ended, vast sums of research funds can be wasted, and valuable time may be lost to exploring incorrect avenues.</p>
<img align="center" src="https://the-turing-way.netlify.app/_images/testing-motivation1.png" alt="logo" title="jupyter" width="600" height="200" /> 
<img align="center" src="https://the-turing-way.netlify.app/_images/testing-motivation2.png" alt="logo" title="jupyter" width="600" height="200" /> <img align="center" src="https://gitlab.com/julia-pfarr/nowaschool/-/raw/main/school/materials/static/CI_CD/CI_CD_tests_imp_1.png?ref_type=heads" alt="logo" title="jupyter" width="500" height="200" /> 
<img align="center" src="https://gitlab.com/julia-pfarr/nowaschool/-/raw/main/school/materials/static/CI_CD/CI_CD_tests_imp_2.png?ref_type=heads" alt="logo" title="jupyter" width="500" height="100" /> </section>
<section id="code-instabilities-and-changes">
<h3>Code instabilities and changes<a class="headerlink" href="#code-instabilities-and-changes" title="Link to this heading">#</a></h3>
<p>The second reason is a also challening but in a different way…The <code class="docutils literal notranslate"><span class="pre">code</span></code> you are using and writing is affected by underlying <code class="docutils literal notranslate"><span class="pre">numerical</span> <span class="pre">instabilities</span></code> and <code class="docutils literal notranslate"><span class="pre">changes</span></code> during development. Just have a look at this example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="mf">0.001</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0000000000000007
</pre></div>
</div>
</div>
</div>
<p>Regarding the first, there are <code class="docutils literal notranslate"><span class="pre">intrinsic</span> <span class="pre">numerical</span> <span class="pre">erros</span> <span class="pre">&amp;</span> <span class="pre">instabilities</span></code> that may lead <code class="docutils literal notranslate"><span class="pre">unstable</span> <span class="pre">functions</span></code> towards <code class="docutils literal notranslate"><span class="pre">distinct</span> <span class="pre">local</span> <span class="pre">minima</span></code>. This phenomenon is only aggravated by prominent differences between <code class="docutils literal notranslate"><span class="pre">OS</span></code>.</p>
<p>Concerning the second, a lot of the <code class="docutils literal notranslate"><span class="pre">code</span></code> you are using is going to be part of <code class="docutils literal notranslate"><span class="pre">packages</span></code> and <code class="docutils literal notranslate"><span class="pre">modules</span></code> that are <code class="docutils literal notranslate"><span class="pre">developed</span></code> and <code class="docutils literal notranslate"><span class="pre">maintained</span></code> by other people. Along this process, the <code class="docutils literal notranslate"><span class="pre">code</span></code>, e.g. a <code class="docutils literal notranslate"><span class="pre">function</span></code>, you are using is going to change, more or less prominently. It could be a <code class="docutils literal notranslate"><span class="pre">rounding</span> <span class="pre">change</span></code> or complete change of <code class="docutils literal notranslate"><span class="pre">inputs</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. Either or, the effects on your application and/or pipeline might be significant and most importantely: unbeknownst to you.</p>
<p>This is why <code class="docutils literal notranslate"><span class="pre">software</span></code> and <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">tests</span></code> are vital! Ie, to ensure the expected outcome and check, as well as evaluate changes along the development process.</p>
</section>
</section>
<section id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">#</a></h2>
<section id="save-time-and-effort">
<h3>save time and effort<a class="headerlink" href="#save-time-and-effort" title="Link to this heading">#</a></h3>
<p>Even if problems in a program are caught before research is published it can be difficult to figure out what results are contaminated and must be re-done. This represents a huge loss of time and effort. Catching these problems as early as possible minimises the amount of work it takes to fix them, and for most researchers time is by far their most scarce resource. You should not skip writing tests because you are short on time, you should write tests because you are short on time. Researchers cannot afford to have months or years of work go down the drain, and they can’t afford to repeatedly manually check every little detail of a program that might be hundreds or hundreds of thousands of lines long. Writing tests to do it for you is the time-saving option, and it’s the safe option.</p>
<img align="center" src="https://media1.tenor.com/m/z67CJVOQTUcAAAAC/aint-nobody-got-time-no.gif" alt="logo" title="jupyter" width="250" height="150" /> </section>
<section id="long-term-confidence">
<h3>long-term confidence<a class="headerlink" href="#long-term-confidence" title="Link to this heading">#</a></h3>
<p>As researchers write code they generally do some tests as they go along, often by adding in print statements and checking the output. However, these tests are often thrown away as soon as they pass and are no longer present to check what they were intended to check. It is comparatively very little work to place these tests in functions and keep them so they can be run at any time in the future. The additional labour is minimal, the time saved and safeguards provided are invaluable. Further, by formalizing the testing process into a suite of tests that can be run independently and automatically, you provide a much greater degree of confidence that the software behaves correctly and increase the likelihood that defects will be found.</p>
<img align="center" src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExZWhiaGx0aW13ejFvbTRjNWFiczMwNDV2dzlnbmQzcDd5a3hqOGEzMyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/TCUF10maUyDV6gguB7/giphy.gif" alt="logo" title="jupyter" width="250" height="250" /> </section>
<section id="peace-of-mind">
<h3>peace of mind<a class="headerlink" href="#peace-of-mind" title="Link to this heading">#</a></h3>
<p>Testing also affords researchers much more peace of mind when working on/improving a project. After changing their code a researcher will want to check that their changes or fixes have not broken anything. Providing researchers with a fail-fast environment allows the rapid identification of failures introduced by changes to the code. The alternative, of the researcher writing and running whatever small tests they have time for is far inferior to a good testing suite which can thoroughly check the code.</p>
<img align="center" src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExMWxjODhxcjFiNGp5ZDFhanB2OXVpNW9pbGlnODlxdjE1eml6M2JmNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/EzTyrBGeAmDSsToZxb/giphy.gif" alt="logo" title="jupyter" width="250" height="150" /> 
</section>
<section id="better-code-from-the-start">
<h3>better code from the start<a class="headerlink" href="#better-code-from-the-start" title="Link to this heading">#</a></h3>
<p>Another benefit of writing tests is that it typically forces a researcher to write cleaner, more modular code as such code is far easier to write tests for, leading to an improvement in code quality. Good quality code is far easier (and altogether more pleasant) to work with than tangled rat’s nests of code I’m sure we’ve all come across (and, let’s be honest, written). This point is expanded upon in the section Unit Testing.</p>
<img align="center" src="https://media1.tenor.com/m/DkF4Sll26-sAAAAd/this-is-the-place-to-start-right.gif" alt="logo" title="jupyter" width="250" height="150" /> 
</section>
<section id="research-software">
<h3>Research software<a class="headerlink" href="#research-software" title="Link to this heading">#</a></h3>
<p>As well as advantaging individual researchers testing also benefits research as a whole. It makes research more reproducible by answering the question “how do we even know this code works”. If tests are never saved, just done and deleted the proof cannot be reproduced easily.</p>
<p>Testing also helps prevent valuable grant money being spent on projects that may be partly or wholly flawed due to mistakes in the code. Worse, if mistakes are not at found and the work is published, any subsequent work that builds upon the project will be similarly flawed.</p>
<p>Perhaps the cleanest expression of why testing is important for research as a whole can be found in the Software Sustainability Institute slogan: better software, better research.</p>
<img align="center" src="https://gitlab.com/julia-pfarr/nowaschool/-/raw/main/school/materials/static/CI_CD/CI_CD_tests_imp_1.png?ref_type=heads" alt="logo" title="jupyter" width="500" height="200" /> 
<img align="center" src="https://gitlab.com/julia-pfarr/nowaschool/-/raw/main/school/materials/static/CI_CD/CI_CD_tests_imp_2.png?ref_type=heads" alt="logo" title="jupyter" width="500" height="100" /> </section>
<section id="write-tests-any-tests">
<h3>Write Tests - Any Tests!<a class="headerlink" href="#write-tests-any-tests" title="Link to this heading">#</a></h3>
<p>Starting the process of writing <code class="docutils literal notranslate"><span class="pre">tests</span></code> can be overwhelming, especially if you have a large <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">base</span></code>. Further to that, as mentioned, there are many kinds of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, and implementing all of them can seem like an impossible mountain to climb. That is why the single most important piece of guidance in this chapter is as follows: write some <code class="docutils literal notranslate"><span class="pre">tests</span></code>. Testing one tiny thing in a <code class="docutils literal notranslate"><span class="pre">code</span></code> that’s thousands of lines long is infinitely better than <code class="docutils literal notranslate"><span class="pre">testing</span></code> nothing in a <code class="docutils literal notranslate"><span class="pre">code</span></code> that’s thousands of lines long. You may not be able to do everything, but doing something is valuable.</p>
<p>Make improvements where you can, and do your best to include <code class="docutils literal notranslate"><span class="pre">tests</span></code> with new <code class="docutils literal notranslate"><span class="pre">code</span></code> you write even if it’s not feasible to write <code class="docutils literal notranslate"><span class="pre">tests</span></code> for all the <code class="docutils literal notranslate"><span class="pre">code</span></code> that’s already written.</p>
<img align="center" src="https://testbytesnxtjsbackend.technoallianceindia.com/wp-content/uploads/2019/06/Untitled-65-1-1.png" alt="logo" title="jupyter" width="500" height="300" /> </section>
<section id="run-the-tests">
<h3>Run the tests<a class="headerlink" href="#run-the-tests" title="Link to this heading">#</a></h3>
<p>The second most important piece of advice in this chapter: <code class="docutils literal notranslate"><span class="pre">run</span></code> the <code class="docutils literal notranslate"><span class="pre">tests</span></code>. Having a beautiful, perfect <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">suite</span></code> is no use if you rarely run it. Leaving long gaps between <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">runs</span></code> makes it more difficult to track down what has gone wrong when a <code class="docutils literal notranslate"><span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">fails</span></code> because, a lot of the <code class="docutils literal notranslate"><span class="pre">code</span></code> will have changed. Also, if it has been weeks or months since <code class="docutils literal notranslate"><span class="pre">tests</span></code> have been run and they fail, it is difficult or impossible to know which results that have been obtained in the mean time are still valid, and which have to be thrown away as they could have been impacted by the <code class="docutils literal notranslate"><span class="pre">bug</span></code>.</p>
<img align="center" src="https://testbytesnxtjsbackend.technoallianceindia.com/wp-content/uploads/2019/06/Untitled-41-1-300x294-1.png" alt="logo" title="jupyter" width="500" height="300" /> <p>It is best to <code class="docutils literal notranslate"><span class="pre">automate</span></code> your <code class="docutils literal notranslate"><span class="pre">testing</span></code> as far as possible. If each <code class="docutils literal notranslate"><span class="pre">test</span></code> needs to be run individually then that boring painstaking process is likely to get neglected. This can be done by making use of a <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">framework</span></code> (discussed later). Ideally set your <code class="docutils literal notranslate"><span class="pre">tests</span></code> up to run at regular intervals, possibly every night.</p>
<p>Consider setting up <code class="docutils literal notranslate"><span class="pre">continuous</span> <span class="pre">integration</span></code> (discussed in the <a class="reference external" href="https://peerherholz.github.io/Clean_Repro_Code_Neuromatch/materials/code_form_test_CI/CI_CD.html">continuous integration sesssion</a>) on your project. This will automatically <code class="docutils literal notranslate"><span class="pre">run</span></code> your <code class="docutils literal notranslate"><span class="pre">tests</span></code> each time you make a change to your <code class="docutils literal notranslate"><span class="pre">code</span></code> and, depending on the <code class="docutils literal notranslate"><span class="pre">continuous</span> <span class="pre">integration</span></code> software you use, will notify you if any of the <code class="docutils literal notranslate"><span class="pre">tests</span></code> <code class="docutils literal notranslate"><span class="pre">fail</span></code>.</p>
</section>
<section id="consider-how-long-it-takes-your-tests-to-run">
<h3>Consider how long it takes your tests to run<a class="headerlink" href="#consider-how-long-it-takes-your-tests-to-run" title="Link to this heading">#</a></h3>
<p>Some tests, like <code class="docutils literal notranslate"><span class="pre">Unit</span> <span class="pre">Testing</span></code> only <code class="docutils literal notranslate"><span class="pre">test</span></code> a small piece of <code class="docutils literal notranslate"><span class="pre">code</span></code> and so typically are very fast. However other kinds of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, such as <code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">Testing</span></code> which <code class="docutils literal notranslate"><span class="pre">test</span></code> the entire <code class="docutils literal notranslate"><span class="pre">code</span></code> from end to end, may take a long time to run depending on the <code class="docutils literal notranslate"><span class="pre">code</span></code>. As such it can be obstructive to run the entire <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">suite</span></code> after each little bit of work.</p>
<img align="center" src="https://media.tenor.com/sArqcAPZZjAAAAAM/robin-williams.gif" alt="logo" title="jupyter" width="250" height="150" /> 
<p>In that case it is better to run lighter weight <code class="docutils literal notranslate"><span class="pre">tests</span></code> such as <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">tests</span></code> frequently, and longer <code class="docutils literal notranslate"><span class="pre">tests</span></code> only once per day, overnight. It is also good to scale the number of each kind of <code class="docutils literal notranslate"><span class="pre">tests</span></code> you have in relation to how long they take to run. You should have a lot of <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">tests</span></code> (or other types of <code class="docutils literal notranslate"><span class="pre">tests</span></code> that are fast) but much fewer <code class="docutils literal notranslate"><span class="pre">tests</span></code> which take a long time to run.</p>
</section>
<section id="document-the-tests-and-how-to-run-them">
<h3>Document the tests and how to run them<a class="headerlink" href="#document-the-tests-and-how-to-run-them" title="Link to this heading">#</a></h3>
<p>It is important to provide documentation that describes how to run the <code class="docutils literal notranslate"><span class="pre">tests</span></code>, both for yourself in case you come back to a project in the future, and for anyone else that may wish to build upon or reproduce your work.</p>
<img align="center" src="https://uploads-ssl.webflow.com/5f3c19f18169b62a0d0bf387/60d33be8cf4ba7565123c8bc_YPD3ulQQAGQpOcnqIm3QzSTRgzmr1SexpW9ZjMpJ1mAnUxx4iF05XOTu44sk0qQG-8XgBcYmGZGAD-5SAZvJl3TjtmhgWnn-w0C2XKwhBscV78RVvhwZfyp0v_Pa6sNj5zxpOvRW.png" alt="logo" title="jupyter" width="250" height="250" /> 
<p>This documentation should also cover subjects such as:</p>
<ul class="simple">
<li><p>any resources, such as <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">dataset</span></code> files that are required</p></li>
<li><p>any <code class="docutils literal notranslate"><span class="pre">configuration</span></code>/<code class="docutils literal notranslate"><span class="pre">settings</span></code> adjustments needed to run the tests</p></li>
<li><p>what <code class="docutils literal notranslate"><span class="pre">software</span></code> (such as <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code>) need to be installed</p></li>
</ul>
<p>Ideally, you would provide scripts to set up and configure any resources that are needed.</p>
</section>
<section id="test-realistic-cases">
<h3>Test Realistic Cases<a class="headerlink" href="#test-realistic-cases" title="Link to this heading">#</a></h3>
<p>Make the cases you <code class="docutils literal notranslate"><span class="pre">test</span></code> as realistic as possible. If for example, you have <code class="docutils literal notranslate"><span class="pre">dummy</span> <span class="pre">data</span></code> to run <code class="docutils literal notranslate"><span class="pre">tests</span></code> on you should make sure that <code class="docutils literal notranslate"><span class="pre">data</span></code> is as similar as possible to the actual <code class="docutils literal notranslate"><span class="pre">data</span></code>. If your actual <code class="docutils literal notranslate"><span class="pre">data</span></code> is messy with a lot of <code class="docutils literal notranslate"><span class="pre">null</span> <span class="pre">values</span></code>, so should your <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">dataset</span></code> be.</p>
</section>
<section id="use-a-testing-framework">
<h3>Use a Testing Framework<a class="headerlink" href="#use-a-testing-framework" title="Link to this heading">#</a></h3>
<p>There are <code class="docutils literal notranslate"><span class="pre">tools</span></code> available to make <code class="docutils literal notranslate"><span class="pre">writing</span></code> and <code class="docutils literal notranslate"><span class="pre">running</span></code> <code class="docutils literal notranslate"><span class="pre">tests</span></code> easier, these are known as <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code>. Find one you like, learn about the features it offers, and make use of them. A very <code class="docutils literal notranslate"><span class="pre">common</span> <span class="pre">testing</span> <span class="pre">framework</span></code> for <code class="docutils literal notranslate"><span class="pre">python</span></code> is <a class="reference external" href="https://docs.pytest.org/en/8.0.x/">pytest</a>.</p>
<iframe src="https://docs.pytest.org/en/stable/" width="650" height="500"></iframe>
</section>
<section id="coverage">
<h3>Coverage<a class="headerlink" href="#coverage" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Code</span> <span class="pre">coverage</span></code> is a measure of how much of your code is “<code class="docutils literal notranslate"><span class="pre">covered</span></code>” by <code class="docutils literal notranslate"><span class="pre">tests</span></code>. More precisely it a measure of how much of your <code class="docutils literal notranslate"><span class="pre">code</span></code> is run when <code class="docutils literal notranslate"><span class="pre">tests</span></code> are conducted. So for example, if you have an <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">statement</span></code> but only <code class="docutils literal notranslate"><span class="pre">test</span></code> things where that <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">statement</span></code> evaluates to “<code class="docutils literal notranslate"><span class="pre">False</span></code>” then none of the <code class="docutils literal notranslate"><span class="pre">code</span></code> in the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">block</span></code> will be run. As a result your <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">coverage</span></code> would be <code class="docutils literal notranslate"><span class="pre">&lt;</span> <span class="pre">100%</span></code>. <code class="docutils literal notranslate"><span class="pre">Code</span> <span class="pre">coverage</span></code> doesn’t include documentation like <code class="docutils literal notranslate"><span class="pre">comments</span></code>, so adding more documentation doesn’t affect your percentages.</p>
<p><code class="docutils literal notranslate"><span class="pre">Code</span> <span class="pre">coverage</span></code> gauges how much <code class="docutils literal notranslate"><span class="pre">code</span></code> your <code class="docutils literal notranslate"><span class="pre">tests</span></code> run, aiming for as close to <code class="docutils literal notranslate"><span class="pre">100%</span></code> as possible without counting documentation. High coverage is ideal, though any <code class="docutils literal notranslate"><span class="pre">testing</span></code> is beneficial. Various <code class="docutils literal notranslate"><span class="pre">tools</span></code> and <code class="docutils literal notranslate"><span class="pre">bots</span></code> measure this across <code class="docutils literal notranslate"><span class="pre">programming</span> <span class="pre">languages</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">pytest</span></code> for <code class="docutils literal notranslate"><span class="pre">python</span></code>. Beware the illusion of good <code class="docutils literal notranslate"><span class="pre">coverage</span></code>; thorough <code class="docutils literal notranslate"><span class="pre">testing</span></code> involves multiple scenarios for the same <code class="docutils literal notranslate"><span class="pre">code</span></code>, emphasizing <code class="docutils literal notranslate"><span class="pre">testing</span></code> smaller <code class="docutils literal notranslate"><span class="pre">code</span></code> chunks for precise logic validation. <code class="docutils literal notranslate"><span class="pre">Testing</span></code> the same code multiple ways is encouraged for comprehensive assessment.</p>
</section>
<section id="use-test-doubles-stubs-mocking-where-appropriate">
<h3>Use test doubles/stubs/mocking where appropriate<a class="headerlink" href="#use-test-doubles-stubs-mocking-where-appropriate" title="Link to this heading">#</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">doubles</span></code> like <code class="docutils literal notranslate"><span class="pre">stubs</span></code> or <code class="docutils literal notranslate"><span class="pre">mocks</span></code> for isolating <code class="docutils literal notranslate"><span class="pre">code</span></code> in <code class="docutils literal notranslate"><span class="pre">tests</span></code>. Ensure <code class="docutils literal notranslate"><span class="pre">tests</span></code> make it easy to pinpoint failures, which can be hard when <code class="docutils literal notranslate"><span class="pre">code</span></code> depends on external factors like <code class="docutils literal notranslate"><span class="pre">internet</span> <span class="pre">connections</span></code> or <code class="docutils literal notranslate"><span class="pre">objects</span></code>. For example, a <code class="docutils literal notranslate"><span class="pre">web</span> <span class="pre">interaction</span> <span class="pre">test</span></code> might <code class="docutils literal notranslate"><span class="pre">fail</span></code> due to internet issues, not <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">bugs</span></code>. Similarly, a <code class="docutils literal notranslate"><span class="pre">test</span></code> involving an <code class="docutils literal notranslate"><span class="pre">object</span></code> might <code class="docutils literal notranslate"><span class="pre">fail</span></code> because of the <code class="docutils literal notranslate"><span class="pre">object</span></code> itself, which should have its own <code class="docutils literal notranslate"><span class="pre">tests</span></code>. Eliminate these dependencies with <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">doubles</span></code>, which come in several types:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Dummy</span> <span class="pre">objects</span></code> are <code class="docutils literal notranslate"><span class="pre">placeholders</span></code> that aren’t actually used in <code class="docutils literal notranslate"><span class="pre">testing</span></code> beyond filling method parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dummy value to fill in as a placeholder</span>
<span class="n">dummy_logger</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
    <span class="c1"># The function doesn&#39;t actually use the logger in this case</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">process_data</span><span class="p">(</span><span class="s2">&quot;input_data&quot;</span><span class="p">,</span> <span class="n">dummy_logger</span><span class="p">))</span>  <span class="c1"># Output: Processed input_data</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Fake</span> <span class="pre">objects</span></code> have simplified, functional implementations, like an <code class="docutils literal notranslate"><span class="pre">in-memory</span> <span class="pre">database</span></code> instead of a real one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fake buffer </span>
<span class="n">fake_buffer</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">add_reading</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">reading</span><span class="p">):</span>
    <span class="n">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reading</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_latest_reading</span><span class="p">(</span><span class="n">buffer</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">buffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">buffer</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># Using the fake buffer in a test</span>
<span class="n">add_reading</span><span class="p">(</span><span class="n">fake_buffer</span><span class="p">,</span> <span class="mf">25.3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_latest_reading</span><span class="p">(</span><span class="n">fake_buffer</span><span class="p">))</span>  <span class="c1"># Output: 25.3</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Stubs</span></code> provide partial implementations to respond only to specific <code class="docutils literal notranslate"><span class="pre">test</span></code> cases and might record call information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stub that only provides results for specific test inputs</span>
<span class="n">stub_calls</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to record calls</span>

<span class="k">def</span> <span class="nf">calculate_distance</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="n">stub_calls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">speed</span><span class="p">,</span> <span class="n">time</span><span class="p">))</span>  <span class="c1"># Record the call</span>
    <span class="k">if</span> <span class="n">speed</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">20</span>  <span class="c1"># A specific expected response</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Using the stub in a test</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calculate_distance</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Output: 20</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stub_calls</span><span class="p">)</span>                 <span class="c1"># Output: [(10, 2)]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Mocks</span></code> simulate <code class="docutils literal notranslate"><span class="pre">interfaces</span></code> or <code class="docutils literal notranslate"><span class="pre">classes</span></code>, with <code class="docutils literal notranslate"><span class="pre">predefined</span> <span class="pre">outputs</span></code> for <code class="docutils literal notranslate"><span class="pre">method</span></code> calls, often recording interactions for <code class="docutils literal notranslate"><span class="pre">test</span></code> validation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">Mock</span>

<span class="c1"># Mock function to simulate a complex calculation</span>
<span class="n">mock_calculate</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Using the mock in a test</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">mock_calculate</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Output: 42</span>

<span class="c1"># Verify the mock was called with specific arguments</span>
<span class="n">mock_calculate</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Test</span> <span class="pre">doubles</span></code> replace real dependencies, making <code class="docutils literal notranslate"><span class="pre">tests</span></code> more focused and reliable. <code class="docutils literal notranslate"><span class="pre">Mocks</span></code> can be hand-coded or generated with <code class="docutils literal notranslate"><span class="pre">mock</span> <span class="pre">frameworks</span></code>, which allow dynamic behavior definition. A common <code class="docutils literal notranslate"><span class="pre">mock</span> <span class="pre">example</span></code> is a <code class="docutils literal notranslate"><span class="pre">data</span></code> provider, where a <code class="docutils literal notranslate"><span class="pre">mock</span></code> simulates the <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">source</span></code> to ensure consistent <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">conditions</span></code>, contrasting with the real <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">source</span></code> used in production.</p>
</section>
</section>
<section id="code-testing-the-basics">
<span id="testing-basics"></span><h2>Code Testing - the basics<a class="headerlink" href="#code-testing-the-basics" title="Link to this heading">#</a></h2>
<p>There are a number of different kinds of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, which will be briefly discussed in the follwing.</p>
<p>Firstly, there are <code class="docutils literal notranslate"><span class="pre">positive</span> <span class="pre">tests</span></code> and <code class="docutils literal notranslate"><span class="pre">negative</span> <span class="pre">tests</span></code>. <code class="docutils literal notranslate"><span class="pre">Positive</span> <span class="pre">tests</span></code> check that something works, for example, <code class="docutils literal notranslate"><span class="pre">testing</span></code> that a <code class="docutils literal notranslate"><span class="pre">function</span></code> that multiplies some numbers together outputs the correct answer. <code class="docutils literal notranslate"><span class="pre">Negative</span> <span class="pre">tests</span></code> check that something generates an <code class="docutils literal notranslate"><span class="pre">error</span></code> when it should. For example, nothing can go quicker than the speed of light, so a plasma physics simulation <code class="docutils literal notranslate"><span class="pre">code</span></code> may contain a test that an error is outputted if there are any particles faster than this, as it indicates there is a deeper problem in the <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p>
<img align="center" src="https://www.techtarget.com/rms/onlineImages/software_quality-postive_vs_negative_test_cases-f.png" alt="logo" title="jupyter" width="800" height="400" /> 
<p>Image credit: <a class="reference external" href="https://www.techtarget.com/rms/onlineImages/software_quality-postive_vs_negative_test_cases-f.png">TechTarget</a>.</p>
<p>In addition to these two kinds of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, there are also different levels of <code class="docutils literal notranslate"><span class="pre">tests</span></code> which <code class="docutils literal notranslate"><span class="pre">test</span></code> different aspects of a project. These levels are outlined below and both <code class="docutils literal notranslate"><span class="pre">positive</span></code> and <code class="docutils literal notranslate"><span class="pre">negative</span> <span class="pre">tests</span></code> can be present at any of these <code class="docutils literal notranslate"><span class="pre">levels</span></code>. A thorough <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">suite</span></code> will contain <code class="docutils literal notranslate"><span class="pre">tests</span></code> at all of these <code class="docutils literal notranslate"><span class="pre">levels</span></code> (though some <code class="docutils literal notranslate"><span class="pre">levels</span></code> will need very few).</p>
<img align="center" src="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc53f283e-6834-45b6-beb9-57b10b2a22fd_1280x1664.gif" alt="logo" title="jupyter" width="400" height="800" /> 
<p>Image credit: <a class="reference external" href="https://blog.bytebytego.com/p/ep83-explaining-9-types-of-api-testing">ByteByteGo</a>.</p>
<p>However, before we will check out the different <code class="docutils literal notranslate"><span class="pre">test</span></code> options, we have to talk about one aspect that is central to all: <code class="docutils literal notranslate"><span class="pre">assert</span></code>.</p>
<section id="assert-a-test-s-best-friend">
<h3>Assert - a test’s best friend<a class="headerlink" href="#assert-a-test-s-best-friend" title="Link to this heading">#</a></h3>
<p>In order to check and evaluate if a certain piece of <code class="docutils literal notranslate"><span class="pre">code</span></code> is doing what it is supposed to do, in a reliable manner, we need a way of <code class="docutils literal notranslate"><span class="pre">assert</span></code>ing what the “correct output” should be and <code class="docutils literal notranslate"><span class="pre">test</span></code>ing the outcome we get against it.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">Python</span></code>, <code class="docutils literal notranslate"><span class="pre">assert</span></code> is a <code class="docutils literal notranslate"><span class="pre">statement</span></code> used to <code class="docutils literal notranslate"><span class="pre">test</span></code> whether a <code class="docutils literal notranslate"><span class="pre">condition</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>. If the <code class="docutils literal notranslate"><span class="pre">condition</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, the program continues to execute as normal. If the <code class="docutils literal notranslate"><span class="pre">condition</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>, the program raises an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> exception and optionally can display an accompanying message. The primary use of <code class="docutils literal notranslate"><span class="pre">assert</span></code> is for <code class="docutils literal notranslate"><span class="pre">debugging</span></code> and <code class="docutils literal notranslate"><span class="pre">testing</span></code> purposes, where it helps to catch <code class="docutils literal notranslate"><span class="pre">errors</span></code> early by ensuring that certain <code class="docutils literal notranslate"><span class="pre">conditions</span></code> hold at specific points in the <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p>
<section id="syntax">
<h4>Syntax<a class="headerlink" href="#syntax" title="Link to this heading">#</a></h4>
<p>The basic <code class="docutils literal notranslate"><span class="pre">syntax</span></code> of an <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">statement</span></code> is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">condition</span><span class="p">,</span> <span class="s2">&quot;Optional error message&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">condition</span></code>: This is the expression to be <code class="docutils literal notranslate"><span class="pre">tested</span></code>. If the <code class="docutils literal notranslate"><span class="pre">condition</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>, nothing happens, and the program continues to execute. If it evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code>, an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> is raised.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Optional</span> <span class="pre">error</span> <span class="pre">message&quot;</span></code>: This is the message that is shown when the <code class="docutils literal notranslate"><span class="pre">condition</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code>. This message is optional, but it’s helpful for understanding why the <code class="docutils literal notranslate"><span class="pre">assertion</span></code> <code class="docutils literal notranslate"><span class="pre">failed</span></code>.</p></li>
</ul>
</section>
<section id="a-simple-example">
<h4>A simple example<a class="headerlink" href="#a-simple-example" title="Link to this heading">#</a></h4>
<p>Here’s a simple example demonstrating how <code class="docutils literal notranslate"><span class="pre">assert</span></code> might be used in a <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">case</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> 

<span class="c1"># Test case for the add function</span>
<span class="k">def</span> <span class="nf">test_add</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> 
    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Expected add(2, 3) to be 5&quot;</span>

<span class="n">test_add</span><span class="p">()</span>  
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">add(2,</span> <span class="pre">3)</span></code> did not <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">5</span></code>, the <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">statement</span></code> raises an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> with the message <code class="docutils literal notranslate"><span class="pre">&quot;Expected</span> <span class="pre">add(2,</span> <span class="pre">3)</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">5&quot;</span></code>.</p>
</section>
<section id="usage-in-testing">
<h4>Usage in Testing<a class="headerlink" href="#usage-in-testing" title="Link to this heading">#</a></h4>
<p>In the context of <code class="docutils literal notranslate"><span class="pre">testing</span></code>, <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">statements</span></code> are used to verify that a <code class="docutils literal notranslate"><span class="pre">function</span></code> or a piece of <code class="docutils literal notranslate"><span class="pre">code</span></code> behaves as expected. They are a simple yet powerful tool for writing <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">cases</span></code>, where you check the <code class="docutils literal notranslate"><span class="pre">outcomes</span></code> of various <code class="docutils literal notranslate"><span class="pre">functions</span></code> under different <code class="docutils literal notranslate"><span class="pre">inputs</span></code>. Here’s how you might use <code class="docutils literal notranslate"><span class="pre">assert</span></code> in a <code class="docutils literal notranslate"><span class="pre">test</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Checking</span> <span class="pre">Function</span> <span class="pre">Outputs</span></code>: To verify that a <code class="docutils literal notranslate"><span class="pre">function</span></code> returns the expected <code class="docutils literal notranslate"><span class="pre">value</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="c1"># Assert that the function output is as expected</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">7</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected 7, but got </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  
<span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">7</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected 7, but got </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">7</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected 7, but got </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="ne">AssertionError</span>: Expected 7, but got 8
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Validating</span> <span class="pre">Data</span> <span class="pre">Types</span></code>: To ensure that <code class="docutils literal notranslate"><span class="pre">variables</span></code> or <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">values</span></code> are of the <code class="docutils literal notranslate"><span class="pre">correct</span> <span class="pre">type</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="c1"># Assert that the return value is a string</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">get_name</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected type str, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">get_name</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected type str, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">name</span> <span class="o">=</span> <span class="n">get_name</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected type str, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="ne">AssertionError</span>: Expected type str, but got int
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Testing</span> <span class="pre">Invariants</span></code>: To check <code class="docutils literal notranslate"><span class="pre">conditions</span></code> that should always be <code class="docutils literal notranslate"><span class="pre">true</span></code> in a given context.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_to_list</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
    <span class="n">lst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lst</span>

<span class="c1"># Testing the invariant: the list should not be empty after adding an item</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">add_to_list</span><span class="p">(</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="p">[])</span>
<span class="k">assert</span> <span class="n">items</span><span class="p">,</span> <span class="s2">&quot;List should not be empty after adding an item&quot;</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Comparing</span> <span class="pre">Data</span> <span class="pre">Structures</span></code>: To ensure that <code class="docutils literal notranslate"><span class="pre">lists</span></code>, <code class="docutils literal notranslate"><span class="pre">dictionaries</span></code>, <code class="docutils literal notranslate"><span class="pre">sets</span></code>, etc., contain the expected <code class="docutils literal notranslate"><span class="pre">elements</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actual_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">expected_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># Assert that both lists are identical</span>
<span class="k">assert</span> <span class="n">actual_list</span> <span class="o">==</span> <span class="n">expected_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_list</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">actual_list</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actual_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">expected_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="c1"># Assert that both lists are identical</span>
<span class="k">assert</span> <span class="n">actual_list</span> <span class="o">==</span> <span class="n">expected_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_list</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">actual_list</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">expected_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Assert that both lists are identical</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="k">assert</span> <span class="n">actual_list</span> <span class="o">==</span> <span class="n">expected_list</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">expected_list</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">actual_list</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="ne">AssertionError</span>: Expected [1, 2, 3], but got [1, 2, 4]
</pre></div>
</div>
</div>
</div>
</section>
<section id="best-practices">
<h4>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">for</span> <span class="pre">Testing</span></code>: Leverage <code class="docutils literal notranslate"><span class="pre">assert</span></code> primarily in <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code> or during the <code class="docutils literal notranslate"><span class="pre">debugging</span> <span class="pre">phase</span></code>, not as a mechanism for handling <code class="docutils literal notranslate"><span class="pre">runtime</span> <span class="pre">errors</span></code> in production <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Clear</span> <span class="pre">Messages</span></code>: Include <code class="docutils literal notranslate"><span class="pre">clear</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptive</span> <span class="pre">messages</span></code> with <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">statements</span></code> to make it easier to identify the cause of a <code class="docutils literal notranslate"><span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">failure</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Test</span> <span class="pre">Precisely</span></code>: Each <code class="docutils literal notranslate"><span class="pre">assert</span></code> should <code class="docutils literal notranslate"><span class="pre">test</span></code> one specific aspect of your <code class="docutils literal notranslate"><span class="pre">code</span></code>’s behavior to make diagnosing issues straightforward.</p></li>
</ul>
</section>
</section>
<section id="runtime-testing">
<h3>Runtime testing<a class="headerlink" href="#runtime-testing" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Runtime</span> <span class="pre">tests</span></code> are <code class="docutils literal notranslate"><span class="pre">tests</span></code> that run as part of the program itself. They may take the form of checks within the <code class="docutils literal notranslate"><span class="pre">code</span></code>, as shown below:</p>
<p>For example, we could use the following <code class="docutils literal notranslate"><span class="pre">runtime</span> <span class="pre">tests</span></code> to <code class="docutils literal notranslate"><span class="pre">test</span></code> the first block of our <a class="reference external" href="https://github.com/PeerHerholz/Clean_Repro_Code_Neuromatch/blob/main/workshop/materials/code_form_test_CI/emd_clust_cont_loss_sim.py">emd_clust_cont_loss_sim.py script</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import all necessary modules and functions</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define paths for all to be generated outputs</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;./outputs/&quot;</span>
<span class="n">output_path_data</span> <span class="o">=</span> <span class="s2">&quot;./outputs/data&quot;</span>


<span class="c1"># For all output paths it should be checked if</span>
<span class="c1"># they exist and if not, they should be created</span>
<span class="n">list_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_path_data</span><span class="p">]</span>

<span class="c1"># Loop over the list of paths that should be checked</span>
<span class="k">for</span> <span class="n">outputs</span> <span class="ow">in</span> <span class="n">list_paths</span><span class="p">:</span>

    <span class="c1"># if path exists, all good</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s2"> exists.&quot;</span><span class="p">)</span>
    <span class="c1"># if not, path should be created</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s2"> does not exist, creating it.&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>


<span class="c1"># Define seeds to address randomness</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Create, check and save simulated data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Check data shape and if incorrect, raise error</span>
<span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data shape as expected: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">str</span>(data.shape))
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data shape should be (2000, 100) but got: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./outputs/ does not exist, creating it.
./outputs/data does not exist, creating it.
data shape as expected: (2000, 100)
</pre></div>
</div>
</div>
</div>
<section id="advantages-of-runtime-testing">
<h4>Advantages of runtime testing:<a class="headerlink" href="#advantages-of-runtime-testing" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">run</span></code> within the program, so can catch problems caused by logic errors or edge cases</p></li>
<li><p>makes it easier to find the cause of the <code class="docutils literal notranslate"><span class="pre">bug</span></code> by catching problems early</p></li>
<li><p>catching problems early also helps prevent them escalating into catastrophic failures. It minimises the blast radius.</p></li>
</ul>
</section>
<section id="disadvantages-of-runtime-testing">
<h4>Disadvantages of runtime testing:<a class="headerlink" href="#disadvantages-of-runtime-testing" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tests</span></code> can slow down the program</p></li>
<li><p>what is the right thing to do if an <code class="docutils literal notranslate"><span class="pre">error</span></code> is detected? How should this <code class="docutils literal notranslate"><span class="pre">error</span></code> be reported? Exceptions are a recommended route to go with this.</p></li>
</ul>
</section>
</section>
</section>
<section id="testing-frameworks">
<span id="id1"></span><h2>Testing frameworks<a class="headerlink" href="#testing-frameworks" title="Link to this heading">#</a></h2>
<p>Before if continue to explore different types of testing, we need to talk about <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code> as
they are essential in the <code class="docutils literal notranslate"><span class="pre">software</span></code> development process, enabling developers and researchers to ensure their <code class="docutils literal notranslate"><span class="pre">code</span></code> behaves as expected. These <code class="docutils literal notranslate"><span class="pre">frameworks</span></code> facilitate various types of <code class="docutils literal notranslate"><span class="pre">testing</span></code>, such as <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">testing</span></code>, <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code>, <code class="docutils literal notranslate"><span class="pre">functional</span> <span class="pre">testing</span></code>, <code class="docutils literal notranslate"><span class="pre">regression</span> <span class="pre">testing</span></code>, and <code class="docutils literal notranslate"><span class="pre">performance</span> <span class="pre">testing</span></code>. By <code class="docutils literal notranslate"><span class="pre">automating</span></code> the execution of <code class="docutils literal notranslate"><span class="pre">tests</span></code>, verifying <code class="docutils literal notranslate"><span class="pre">outcomes</span></code>, and <code class="docutils literal notranslate"><span class="pre">reporting</span> <span class="pre">results</span></code>, <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code> help improve <code class="docutils literal notranslate"><span class="pre">code</span> <span class="pre">quality</span></code> and <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">stability</span></code>.</p>
<p>Importantly, you should start utilizing them right away and don’t switch to a <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">framework</span></code> later on in your project. While you could of course do that, using them from the get go will save you a lot of time and help catch/prevent errors immediately. That’s why we talk about them before addressing different test types so that we can showcase the latter in a test framework for best practice.</p>
<section id="key-features-of-testing-frameworks">
<span id="testing-frameworks-features"></span><h3>Key Features of Testing Frameworks<a class="headerlink" href="#key-features-of-testing-frameworks" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Test Organization</strong>: Helps structure and manage tests effectively.</p></li>
<li><p><strong>Fixture Management</strong>: Supports setup and teardown operations for tests.</p></li>
<li><p><strong>Assertion Support</strong>: Provides tools for verifying test outcomes.</p></li>
<li><p><strong>Automated Test Discovery</strong>: Automatically identifies and runs tests.</p></li>
<li><p><strong>Mocking and Patching</strong>: Allows isolation of the system under test.</p></li>
<li><p><strong>Parallel Test Execution</strong>: Reduces test suite execution time.</p></li>
<li><p><strong>Extensibility</strong>: Offers customization through plugins and hooks.</p></li>
<li><p><strong>Reporting</strong>: Generates detailed reports on test outcomes.</p></li>
</ul>
</section>
<section id="setup-for-using-testing-frameworks">
<span id="testing-frameworks-setup"></span><h3>Setup for using testing frameworks<a class="headerlink" href="#setup-for-using-testing-frameworks" title="Link to this heading">#</a></h3>
<p>While you could add tests directly to your <code class="docutils literal notranslate"><span class="pre">code</span></code>, we recommend refactoring and reorganizing your project setup slightly to keep everything <code class="docutils literal notranslate"><span class="pre">organized</span></code>, <code class="docutils literal notranslate"><span class="pre">testable</span></code>, and <code class="docutils literal notranslate"><span class="pre">maintainable</span></code> without duplicating <code class="docutils literal notranslate"><span class="pre">code</span></code> between your <code class="docutils literal notranslate"><span class="pre">analysis</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">scripts</span></code>.</p>
<p>In general, this entails the following aspects:</p>
<ul class="simple">
<li><p>have separate scripts for the <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> and its respective <code class="docutils literal notranslate"><span class="pre">tests</span></code></p></li>
<li><p>write <code class="docutils literal notranslate"><span class="pre">functions</span></code> for parts of your <code class="docutils literal notranslate"><span class="pre">code</span></code> that run certain tasks/elements (e.g. <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">downloading</span></code>, <code class="docutils literal notranslate"><span class="pre">preprocessing</span></code>, <code class="docutils literal notranslate"><span class="pre">analyses</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span></code> and <code class="docutils literal notranslate"><span class="pre">test</span></code> these <code class="docutils literal notranslate"><span class="pre">functions</span></code> in the <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">scripts</span></code></p></li>
</ul>
<p>With that, you have one “truth” of the <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> and can automatically <code class="docutils literal notranslate"><span class="pre">test</span></code> different parts of them using the <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">framework</span></code>.</p>
<img align="center" src="" alt="overview graphic" title="jupyter" width="400" height="800" /> <p>There are many different testing frameworks for <code class="docutils literal notranslate"><span class="pre">python</span></code>, including <a class="reference external" href="https://behave.readthedocs.io/en/latest/">behave</a>, <a class="reference external" href="https://robotframework.org/">Robot Framework</a> and <a class="reference external" href="https://github.com/testproject-io">TestProject</a>. However, we will focus on <a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a>.</p>
</section>
<section id="pytest">
<h3><code class="docutils literal notranslate"><span class="pre">pytest</span></code><a class="headerlink" href="#pytest" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://docs.pytest.org/en/stable/">pytest</a> is a powerful <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">framework</span></code> for <code class="docutils literal notranslate"><span class="pre">Python</span></code> that is easy to start with but also supports complex functional <code class="docutils literal notranslate"><span class="pre">testing</span></code>. It is known for its simple <code class="docutils literal notranslate"><span class="pre">syntax</span></code>, detailed <code class="docutils literal notranslate"><span class="pre">assertion</span></code> introspection, <code class="docutils literal notranslate"><span class="pre">automatic</span> <span class="pre">test</span></code> discovery, and a wide range of <code class="docutils literal notranslate"><span class="pre">plugins</span></code> and <code class="docutils literal notranslate"><span class="pre">integrations</span></code>.</p>
<section id="running-pytest">
<h4>Running pytest<a class="headerlink" href="#running-pytest" title="Link to this heading">#</a></h4>
<p>There are various options to run <code class="docutils literal notranslate"><span class="pre">pytest</span></code>. Let’s start with the easiest one, running all <code class="docutils literal notranslate"><span class="pre">tests</span></code> written in a specific <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">directory</span></code>, ie the <code class="docutils literal notranslate"><span class="pre">setup</span></code> we introduce above.<br />
At first, you need to ensure <code class="docutils literal notranslate"><span class="pre">pytest</span></code> is installed in your <code class="docutils literal notranslate"><span class="pre">computational</span> <span class="pre">environment</span></code>. If not, install it using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pip install pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: pytest in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (8.3.3)
Requirement already satisfied: pluggy&lt;2,&gt;=1.5 in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (from pytest) (1.5.0)
Requirement already satisfied: iniconfig in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (from pytest) (2.0.0)
Requirement already satisfied: exceptiongroup&gt;=1.0.0rc8 in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (from pytest) (1.2.0)
Requirement already satisfied: tomli&gt;=1 in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (from pytest) (2.0.1)
Requirement already satisfied: packaging in /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages (from pytest) (23.2)
</pre></div>
</div>
</div>
</div>
<p>Additionally, you have to make sure that all your <code class="docutils literal notranslate"><span class="pre">tests</span></code> are placed in a dedicated <code class="docutils literal notranslate"><span class="pre">directory</span></code> and that their filenames follows one of these patterns: <code class="docutils literal notranslate"><span class="pre">test_*.py</span></code> or <code class="docutils literal notranslate"><span class="pre">*_test.py</span></code>.</p>
<p>they should ideally be placed in a dedicated directory that is different from the path where you work on the <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analysis</span> <span class="pre">scripts</span></code>. Thus, let’s create a respective <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">directory</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./tests&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will create our <code class="docutils literal notranslate"><span class="pre">test</span></code> files and save them in the <code class="docutils literal notranslate"><span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">directory</span></code>.</p>
</section>
<section id="writing-basic-tests-with-pytest">
<h4>Writing Basic Tests with <code class="docutils literal notranslate"><span class="pre">pytest</span></code><a class="headerlink" href="#writing-basic-tests-with-pytest" title="Link to this heading">#</a></h4>
<p>Tests in <code class="docutils literal notranslate"><span class="pre">pytest</span></code> are simple to write. Starting with test functions, as tests grow, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> provides a rich set of features for more complex scenarios. The crucial parts as mentioned before are: <code class="docutils literal notranslate"><span class="pre">assert</span></code> and using <code class="docutils literal notranslate"><span class="pre">functions</span></code>. You can write one <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">file</span></code> per <code class="docutils literal notranslate"><span class="pre">test</span></code> or have multiple <code class="docutils literal notranslate"><span class="pre">tests</span></code> in a single <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">file</span></code> based on their intended behavior/function.</p>
<p>We will start with a very simple example of the former.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_addition.py


<span class="k">def</span> <span class="nf">test_example</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_addition.py
</pre></div>
</div>
</div>
</div>
<p>We can now run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> by pointing it to the <code class="docutils literal notranslate"><span class="pre">directory</span></code> where we created and saved the <code class="docutils literal notranslate"><span class="pre">test</span></code> files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 1 item

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.04s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> will automatically discover <code class="docutils literal notranslate"><span class="pre">tests</span></code> within any <code class="docutils literal notranslate"><span class="pre">files</span></code> that match the <code class="docutils literal notranslate"><span class="pre">pattern</span></code> described above in the <code class="docutils literal notranslate"><span class="pre">directory</span></code> and its <code class="docutils literal notranslate"><span class="pre">subdirectories</span></code>. As you can see above, it provides a comprehensive output report with details about the <code class="docutils literal notranslate"><span class="pre">computational</span> <span class="pre">environment</span></code> (used <code class="docutils literal notranslate"><span class="pre">software</span></code> and its <code class="docutils literal notranslate"><span class="pre">version</span></code>), as well as how many tests were run, their coverage of the <code class="docutils literal notranslate"><span class="pre">code</span></code> and if they resulted in <code class="docutils literal notranslate"><span class="pre">pass</span></code> or <code class="docutils literal notranslate"><span class="pre">fail</span></code>.</p>
<p>Using this setup it’s easy to run <code class="docutils literal notranslate"><span class="pre">automated</span> <span class="pre">tests</span></code> whenever you change something in your <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> and evaluate if that had an effect on the expected <code class="docutils literal notranslate"><span class="pre">behavior</span></code>/<code class="docutils literal notranslate"><span class="pre">function</span></code> of the <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p>
<p>Let’s check a few more things about <code class="docutils literal notranslate"><span class="pre">pytest</span></code> that will come in handy when working with complex <code class="docutils literal notranslate"><span class="pre">scripts</span></code>.</p>
</section>
<section id="using-fixtures-for-setup-and-teardown">
<h4>Using Fixtures for Setup and Teardown<a class="headerlink" href="#using-fixtures-for-setup-and-teardown" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> fixtures define setup and teardown logic for <code class="docutils literal notranslate"><span class="pre">tests</span></code>, ensuring <code class="docutils literal notranslate"><span class="pre">tests</span></code> <code class="docutils literal notranslate"><span class="pre">run</span></code> under <code class="docutils literal notranslate"><span class="pre">controlled</span> <span class="pre">conditions</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_fixture.py

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">sample_data</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">sum</span>
<span class="k">def</span> <span class="nf">test_sum</span><span class="p">(</span><span class="n">sample_data</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_fixture.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameterizing-tests">
<h4>Parameterizing Tests<a class="headerlink" href="#parameterizing-tests" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pytest</span></code> allows running a single <code class="docutils literal notranslate"><span class="pre">test</span></code> function with different <code class="docutils literal notranslate"><span class="pre">inputs</span></code> using <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_parameterized.py

<span class="kn">import</span> <span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;a,b,expected&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_addition</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_parameterized.py
</pre></div>
</div>
</div>
</div>
<p>We can now run all <code class="docutils literal notranslate"><span class="pre">tests</span></code> by pointing <code class="docutils literal notranslate"><span class="pre">pytest</span></code> to the respective <code class="docutils literal notranslate"><span class="pre">directory</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 5 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 20%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [ 40%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 60%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 80%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">5 passed</span><span class=" -Color -Color-Green"> in 0.16s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>or run specific <code class="docutils literal notranslate"><span class="pre">tests</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">tests</span></code> from a specific <code class="docutils literal notranslate"><span class="pre">file</span></code> or those matching a certain <code class="docutils literal notranslate"><span class="pre">pattern</span></code>.<br />
You can specify the <code class="docutils literal notranslate"><span class="pre">file</span></code> like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests/test_fixture.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 1 item

tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.02s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>or <code class="docutils literal notranslate"><span class="pre">run</span></code> <code class="docutils literal notranslate"><span class="pre">tests</span></code> matching a name pattern like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests/ -k &quot;test_addition&quot;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 5 items / 1 deselected / 4 selected

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 25%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 50%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 75%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [100%]</span>

<span class=" -Color -Color-Green">======================= </span><span class=" -Color -Color-Bold -Color-Bold-Green">4 passed</span>, <span class=" -Color -Color-Yellow">1 deselected</span><span class=" -Color -Color-Green"> in 0.03s ========================</span>
</pre></div>
</div>
</div>
</div>
<p>You can also <code class="docutils literal notranslate"><span class="pre">run</span></code> <code class="docutils literal notranslate"><span class="pre">tests</span></code> marked with a <code class="docutils literal notranslate"><span class="pre">Custom</span> <span class="pre">Marker</span></code>: If you’ve used <code class="docutils literal notranslate"><span class="pre">custom</span> <span class="pre">markers</span></code> to decorate your <code class="docutils literal notranslate"><span class="pre">tests</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.regression</span></code>), you can <code class="docutils literal notranslate"><span class="pre">run</span></code> only the <code class="docutils literal notranslate"><span class="pre">tests</span></code> with that <code class="docutils literal notranslate"><span class="pre">marker</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests/ -m &quot;sum&quot; -v
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 5 items / 4 deselected / 1 selected

tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [100%]</span>

<span class=" -Color -Color-Green">======================= </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span>, <span class=" -Color -Color-Yellow">4 deselected</span><span class=" -Color -Color-Green"> in 0.02s ========================</span>
</pre></div>
</div>
</div>
</div>
<p>NB: we do get a <code class="docutils literal notranslate"><span class="pre">warning</span></code> related to an <code class="docutils literal notranslate"><span class="pre">unregistered</span> <span class="pre">marker</span></code> as we didn’t create a <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> file yet.
The <code class="docutils literal notranslate"><span class="pre">pytest.ini</span> <span class="pre">file</span></code> is a <code class="docutils literal notranslate"><span class="pre">configuration</span> <span class="pre">file</span></code> for <code class="docutils literal notranslate"><span class="pre">pytest</span></code> that allows you to specify <code class="docutils literal notranslate"><span class="pre">settings</span></code>, register custom <code class="docutils literal notranslate"><span class="pre">markers</span></code>, <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">test</span> <span class="pre">paths</span></code>, and more. It is typically placed in the <code class="docutils literal notranslate"><span class="pre">root</span> <span class="pre">directory</span></code> of your <code class="docutils literal notranslate"><span class="pre">project</span></code> and helps streamline the <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">setup</span></code> by keeping <code class="docutils literal notranslate"><span class="pre">configurations</span></code> in one place.</p>
<p>Thus, let’s create one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./pytest.ini

<span class="p">[</span><span class="n">pytest</span><span class="p">]</span>
<span class="c1"># Register custom markers to avoid warnings</span>
<span class="n">markers</span> <span class="o">=</span>
    <span class="nb">sum</span><span class="p">:</span> <span class="n">mark</span> <span class="n">a</span> <span class="n">test</span> <span class="k">as</span> <span class="n">related</span> <span class="n">to</span> <span class="n">summation</span> <span class="n">operations</span>

<span class="c1"># Default command-line options</span>
<span class="n">addopts</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>

<span class="c1"># Specify default test directories</span>
<span class="n">testpaths</span> <span class="o">=</span> <span class="o">./</span><span class="n">tests</span>

<span class="c1"># Specify the path for the source files</span>
<span class="n">pythonpath</span> <span class="o">=</span> <span class="o">.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./pytest.ini
</pre></div>
</div>
</div>
</div>
<p>With that in place, we can now run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> with even less effort.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 5 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 20%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [ 40%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 60%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 80%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">5 passed</span><span class=" -Color -Color-Green"> in 0.02s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>After learning about the basics of <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code>, it’s time to check how we can use them to implement different <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">types</span></code> by also incorporating the <code class="docutils literal notranslate"><span class="pre">setup</span></code> we talked about before.</p>
</section>
</section>
</section>
<section id="code-testing-different-types-of-tests">
<h2>Code testing - different types of tests<a class="headerlink" href="#code-testing-different-types-of-tests" title="Link to this heading">#</a></h2>
<p>We already explored different types of tests a little bit in the <a class="reference internal" href="#testing-basics"><span class="std std-ref">above section</span></a> but it’s time to go more into detail and learned more about common <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">types</span></code> by using them for our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code>.</p>
<section id="smoke-tests">
<h3>Smoke tests<a class="headerlink" href="#smoke-tests" title="Link to this heading">#</a></h3>
<p>These are very brief initial checks that ensures the basic requirements required to run the <code class="docutils literal notranslate"><span class="pre">code</span></code> hold. If these <code class="docutils literal notranslate"><span class="pre">fail</span></code> there is no point proceeding to additional levels of <code class="docutils literal notranslate"><span class="pre">testing</span></code> until they are fixed.</p>
<p>One example for our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> would be to check if the <code class="docutils literal notranslate"><span class="pre">directories</span></code> in the <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">paths</span></code> are created, as without them, we wouldn’t get our <code class="docutils literal notranslate"><span class="pre">outputs</span></code> saved at all or somewhere else.</p>
<p>As mentioned before, to follow best practices and make things manageable and easy for the long run, we need to refractor our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> to run certain parts within <code class="docutils literal notranslate"><span class="pre">functions</span></code> that we can <code class="docutils literal notranslate"><span class="pre">import</span></code> in the <code class="docutils literal notranslate"><span class="pre">tests</span></code>.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">directory</span> <span class="pre">generation</span></code> part, we would change things from:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import all necessary modules and functions</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">BayesianGaussianMixture</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Define paths for all to be generated outputs</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;./outputs/&quot;</span>
<span class="n">output_path_data</span> <span class="o">=</span> <span class="s2">&quot;./outputs/data&quot;</span>
<span class="n">output_path_graphics</span> <span class="o">=</span> <span class="s2">&quot;./outputs/graphics&quot;</span>
<span class="n">output_path_models</span> <span class="o">=</span> <span class="s2">&quot;./outputs/models&quot;</span>

<span class="c1"># For all output paths it should be checked if</span>
<span class="c1"># they exist and if not, they should be created</span>
<span class="n">list_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_path_data</span><span class="p">,</span> <span class="n">output_path_graphics</span><span class="p">,</span>
              <span class="n">output_path_models</span><span class="p">]</span>

<span class="c1"># Loop over the list of paths that should be checked</span>
<span class="k">for</span> <span class="n">outputs</span> <span class="ow">in</span> <span class="n">list_paths</span><span class="p">:</span>

    <span class="c1"># if path exists, all good</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outputs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s2"> exists.&quot;</span><span class="p">)</span>
    <span class="c1"># if not, path should be created</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputs</span><span class="si">}</span><span class="s2"> does not exist, creating it.&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Define utility function to create paths</span>
<span class="k">def</span> <span class="nf">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="c1"># Run all steps of the code/analysis</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set up output directories</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>So, let’s create a respective version of our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> to make this possible. It’s not best practice but for now we will create a new file instead of updating the old one so that we can easily compare them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./emd_clust_cont_loss_sim_functions.py

<span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Define utility function to create paths</span>
<span class="k">def</span> <span class="nf">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="c1"># Define test directories</span>
<span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>


<span class="c1"># Run all steps of the code/analysis</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set up output directories</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./emd_clust_cont_loss_sim_functions.py
</pre></div>
</div>
</div>
</div>
<p>We can now setup a <code class="docutils literal notranslate"><span class="pre">smoke</span> <span class="pre">test</span></code> to evaluate if the <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">paths</span></code> are generated as expected by utilizing, ie <code class="docutils literal notranslate"><span class="pre">import</span></code>ing, the just defined <code class="docutils literal notranslate"><span class="pre">function</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_paths.py


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">emd_clust_cont_loss_sim_functions</span> <span class="kn">import</span> <span class="n">create_output_paths</span> 

<span class="c1"># Define test paths (use temporary or unique paths to avoid overwriting real data)</span>
<span class="n">test_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./test_outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/models&quot;</span><span class="p">]</span>

<span class="c1"># Define tests</span>
<span class="k">def</span> <span class="nf">test_create_output_paths</span><span class="p">():</span>

    <span class="c1"># Run the path creation function</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">test_paths</span><span class="p">)</span>

    <span class="c1"># Check if each path now exists</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">test_paths</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected directory </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> to be created, but it was not.&quot;</span>

    <span class="c1"># Cleanup - remove the directories after the test to keep the environment clean</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">test_paths</span><span class="p">):</span>  <span class="c1"># Remove subdirectories before parent directory</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Cleanup - remove generated outputs to keep the test environment clean</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">test_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_paths.py
</pre></div>
</div>
</div>
</div>
<p>With everything in place, we can now run <code class="docutils literal notranslate"><span class="pre">pytest</span></code> as we did before, pointing it to the specific <code class="docutils literal notranslate"><span class="pre">test</span></code> that we would like to <code class="docutils literal notranslate"><span class="pre">run</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest tests/test_paths.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 1 item

tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED                     [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.03s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>That appears to work out, great! We could also run all <code class="docutils literal notranslate"><span class="pre">tests</span></code> like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 6 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 16%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [ 33%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 50%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 66%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [ 83%]</span>
tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED                     [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">6 passed</span><span class=" -Color -Color-Green"> in 0.04s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>Isn’t that great? Let’s continue with exploring and adding more <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">types</span></code>!</p>
</section>
<section id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Link to this heading">#</a></h3>
<p>A level of the <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">testing</span></code> process where individual <code class="docutils literal notranslate"><span class="pre">units</span></code> of a <code class="docutils literal notranslate"><span class="pre">software</span></code> are <code class="docutils literal notranslate"><span class="pre">tested</span></code>. The purpose is to validate that each <code class="docutils literal notranslate"><span class="pre">unit</span></code> of the <code class="docutils literal notranslate"><span class="pre">software</span></code> performs as designed. For example, in our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code>, we could evaluate if the <code class="docutils literal notranslate"><span class="pre">functions</span></code> for <code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code> generation work as expected. Thus, we could write a <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">test</span></code> for both comparing the expected to the actual output.</p>
<p>At first, we need to refactor the <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">generation</span></code> in our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> to be run as a <code class="docutils literal notranslate"><span class="pre">function</span></code>, ie adding it to the new version of the script.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./emd_clust_cont_loss_sim_functions.py

<span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define utility function to create paths</span>
<span class="k">def</span> <span class="nf">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="c1"># Define utility function to generate data</span>
<span class="k">def</span> <span class="nf">simulate_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./outputs/data/raw_data_sim.npy&quot;</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">size</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="c1"># Run all steps of the code/analysis</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set up output directories</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

    <span class="c1"># Simulate data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./emd_clust_cont_loss_sim_functions.py
</pre></div>
</div>
</div>
</div>
<p>Subsequently, we need to write respective <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">tests</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_path_sim_data_gen.py


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">emd_clust_cont_loss_sim_functions</span> <span class="kn">import</span> <span class="n">create_output_paths</span><span class="p">,</span> <span class="n">simulate_data</span>

<span class="c1"># Define temporary test paths to avoid overwriting real data</span>
<span class="n">test_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./test_outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/models&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">test_create_output_paths</span><span class="p">():</span>
    <span class="c1"># Run the path creation function</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">test_paths</span><span class="p">)</span>
    
    <span class="c1"># Check if each path now exists</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">test_paths</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected directory </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> to be created, but it was not.&quot;</span>


<span class="k">def</span> <span class="nf">test_simulate_data</span><span class="p">():</span>
    <span class="c1"># Generate test data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./test_outputs/data/raw_data_sim.npy&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check type and shape</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Expected output type np.ndarray&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="s2">&quot;Expected output shape (100, 50)&quot;</span>

    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;./test_outputs/data/raw_data_sim.npy&quot;</span><span class="p">)</span>


<span class="c1"># Cleanup - remove generated outputs to keep the test environment clean</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">test_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_path_sim_data_gen.py
</pre></div>
</div>
</div>
</div>
<p>Using our, by now, well-know <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, we run the <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">tests</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 8 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 12%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [ 25%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 37%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 50%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [ 62%]</span>
tests/test_path_sim_data_gen.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED         [ 75%]</span>
tests/test_path_sim_data_gen.py::test_simulate_data <span class=" -Color -Color-Green">PASSED               [ 87%]</span>
tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED                     [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">8 passed</span><span class=" -Color -Color-Green"> in 0.18s ===============================</span>
</pre></div>
</div>
</div>
</div>
<section id="unit-testing-tips">
<h4>Unit Testing Tips<a class="headerlink" href="#unit-testing-tips" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>many <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code> have <code class="docutils literal notranslate"><span class="pre">tools</span></code> specifically geared towards writing and running unit tests, <code class="docutils literal notranslate"><span class="pre">pytest</span></code> does as well</p></li>
</ul>
<ul class="simple">
<li><p>isolate the <code class="docutils literal notranslate"><span class="pre">development</span> <span class="pre">environment</span></code> from the <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">environment</span></code></p></li>
</ul>
<ul class="simple">
<li><p>write <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">cases</span></code> that are independent of each other. For example, if a <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">A</span></code> utilises the result supplied by another <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">B</span></code>, you should <code class="docutils literal notranslate"><span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">A</span></code> with a <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">double</span></code>, rather than actually calling the <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">B</span></code>. If you don’t do this your <code class="docutils literal notranslate"><span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">failing</span></code> may be due to a fault in either <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">A</span></code> or <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">B</span></code>, making the <code class="docutils literal notranslate"><span class="pre">bug</span></code> harder to trace.</p></li>
</ul>
<ul class="simple">
<li><p>aim at <code class="docutils literal notranslate"><span class="pre">covering</span></code> all <code class="docutils literal notranslate"><span class="pre">paths</span></code> through a <code class="docutils literal notranslate"><span class="pre">unit</span></code>, pay particular attention to <code class="docutils literal notranslate"><span class="pre">loop</span> <span class="pre">conditions</span></code>.</p></li>
</ul>
<ul class="simple">
<li><p>in addition to <code class="docutils literal notranslate"><span class="pre">writing</span> <span class="pre">cases</span></code> to verify the behaviour, write <code class="docutils literal notranslate"><span class="pre">cases</span></code> to ensure the <code class="docutils literal notranslate"><span class="pre">performance</span></code> of the <code class="docutils literal notranslate"><span class="pre">code</span></code>. For example, if a <code class="docutils literal notranslate"><span class="pre">function</span></code> that is supposed to add <code class="docutils literal notranslate"><span class="pre">two</span> <span class="pre">numbers</span></code> takes several minutes to run there is likely a problem.</p></li>
</ul>
<ul class="simple">
<li><p>if you find a defect in your <code class="docutils literal notranslate"><span class="pre">code</span></code> write a <code class="docutils literal notranslate"><span class="pre">test</span></code> that exposes it. Why? First, you will later be able to catch the defect if you do not fix it properly. Second, your <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">suite</span></code> is now more comprehensive. Third, you will most probably be too lazy to write the <code class="docutils literal notranslate"><span class="pre">test</span></code> after you have already fixed the defect.</p></li>
</ul>
</section>
</section>
<section id="integration-tests">
<h3>Integration tests<a class="headerlink" href="#integration-tests" title="Link to this heading">#</a></h3>
<p>A level of <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">testing</span></code> where <code class="docutils literal notranslate"><span class="pre">individual</span> <span class="pre">units</span></code> are combined and <code class="docutils literal notranslate"><span class="pre">tested</span></code> as a <code class="docutils literal notranslate"><span class="pre">group</span></code>. The purpose of this level of <code class="docutils literal notranslate"><span class="pre">testing</span></code> is to expose faults in the interaction between integrated <code class="docutils literal notranslate"><span class="pre">units</span></code>.</p>
<section id="integration-testing-approaches">
<h4>Integration Testing Approaches<a class="headerlink" href="#integration-testing-approaches" title="Link to this heading">#</a></h4>
<p>There are several different approaches to <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Big</span> <span class="pre">Bang</span></code>: an approach to <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> where all or most of the <code class="docutils literal notranslate"><span class="pre">units</span></code> are combined together and tested at one go. This approach is taken when the <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">team</span></code> receives the entire <code class="docutils literal notranslate"><span class="pre">software</span></code> in a bundle. So what is the difference between <code class="docutils literal notranslate"><span class="pre">Big</span> <span class="pre">Bang</span></code> <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> and <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">testing</span></code>? Well, the former <code class="docutils literal notranslate"><span class="pre">tests</span></code> only the <code class="docutils literal notranslate"><span class="pre">interactions</span></code> between the <code class="docutils literal notranslate"><span class="pre">units</span></code> while the latter <code class="docutils literal notranslate"><span class="pre">tests</span></code> the entire system.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">Down</span></code>: an approach to <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> where <code class="docutils literal notranslate"><span class="pre">top-level</span> <span class="pre">sections</span></code> of the <code class="docutils literal notranslate"><span class="pre">code</span></code> (that themselves contain many smaller <code class="docutils literal notranslate"><span class="pre">units</span></code>) are <code class="docutils literal notranslate"><span class="pre">tested</span> <span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">lower</span> <span class="pre">level</span> <span class="pre">units</span></code> are <code class="docutils literal notranslate"><span class="pre">tested</span></code> step by step after that.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Bottom</span> <span class="pre">Up</span></code>: an approach to <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> where <code class="docutils literal notranslate"><span class="pre">integration</span></code> between bottom level sections are tested first and upper-level sections step by step after that. Again <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">stubs</span></code> should be used, in this case to <code class="docutils literal notranslate"><span class="pre">simulate</span></code> <code class="docutils literal notranslate"><span class="pre">inputs</span></code> from higher level sections.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Sandwich</span></code>/<code class="docutils literal notranslate"><span class="pre">Hybrid</span></code> is an approach to <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> which is a combination of <code class="docutils literal notranslate"><span class="pre">Top</span> <span class="pre">Down</span></code> and <code class="docutils literal notranslate"><span class="pre">Bottom</span> <span class="pre">Up</span></code> approaches.</p></li>
</ul>
<p>Which approach you should use will depend on which best suits the nature/structure of your project.</p>
<p>Based on our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code>, we could test a sequence of steps from <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">generation</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span> <span class="pre">training</span></code>, and <code class="docutils literal notranslate"><span class="pre">output</span> <span class="pre">generation</span></code>.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">End-to-End</span> <span class="pre">Path</span></code> and <code class="docutils literal notranslate"><span class="pre">Directory</span></code> Creation: Verify that <code class="docutils literal notranslate"><span class="pre">create_output_paths</span></code> sets up all necessary <code class="docutils literal notranslate"><span class="pre">directories</span></code>, and these <code class="docutils literal notranslate"><span class="pre">directories</span></code> are populated with <code class="docutils literal notranslate"><span class="pre">files</span></code> or <code class="docutils literal notranslate"><span class="pre">data</span></code> generated by the pipeline.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Generation</span></code> to <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Training</span></code>: <code class="docutils literal notranslate"><span class="pre">Simulate</span> <span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">split</span></code> it, and ensure that the <code class="docutils literal notranslate"><span class="pre">model</span></code> can be <code class="docutils literal notranslate"><span class="pre">trained</span></code> on this <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">Training</span></code> with <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">Verification</span></code>: Run a short <code class="docutils literal notranslate"><span class="pre">training</span></code> session and verify that the <code class="docutils literal notranslate"><span class="pre">loss</span></code> decreases over a few <code class="docutils literal notranslate"><span class="pre">epochs</span></code>, indicating the <code class="docutils literal notranslate"><span class="pre">model</span></code> is <code class="docutils literal notranslate"><span class="pre">learning</span></code>.</p></li>
</ol>
<p>The first step, as always, is to adapt our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> so that all needed aspects are run in via <code class="docutils literal notranslate"><span class="pre">functions</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./emd_clust_cont_loss_sim_functions.py


<span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>


<span class="c1"># Define utility function to create paths</span>
<span class="k">def</span> <span class="nf">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="c1"># Define utility function to generate data</span>
<span class="k">def</span> <span class="nf">simulate_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./outputs/data/raw_data_sim.npy&quot;</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">size</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

    
<span class="c1"># Define class for the Encoder</span>
<span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Encoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Define class for the MLP</span>
<span class="k">class</span> <span class="nc">MLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MLP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Define class for the contrastive loss</span>
<span class="k">class</span> <span class="nc">ContrastiveLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContrastiveLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="n">margin</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output1</span><span class="p">,</span> <span class="n">output2</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="n">euclidean_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">output1</span> <span class="o">-</span> <span class="n">output2</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">label</span><span class="p">)</span> <span class="o">*</span> <span class="n">euclidean_distance</span> <span class="o">+</span> <span class="n">label</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">-</span> <span class="n">euclidean_distance</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>


<span class="c1"># Define utility function to train the encoder</span>
<span class="k">def</span> <span class="nf">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="n">loss_function</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">representations_during_training</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_function</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">data_train</span><span class="p">[:,</span> <span class="p">:</span><span class="n">encoder</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">out_features</span><span class="p">])</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

        <span class="c1"># Save representations every 1000 epochs</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">representations_during_training</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">encoder</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">losses</span><span class="p">,</span> <span class="n">representations_during_training</span>


<span class="c1"># Run all steps of the code/analysis</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set up output directories</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

    <span class="c1"># Simulate data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">()</span>

    <span class="c1"># Train Encoder</span>
    <span class="n">data_train</span><span class="p">,</span> <span class="n">data_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">data_train_torch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">losses</span><span class="p">,</span> <span class="n">representations_during_training</span> <span class="o">=</span> <span class="n">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train_torch</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./emd_clust_cont_loss_sim_functions.py
</pre></div>
</div>
</div>
</div>
<p>Next, we need to write <code class="docutils literal notranslate"><span class="pre">tests</span></code> that evaluate the included parts of the <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> back-to-back.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_pipeline.py


<span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">emd_clust_cont_loss_sim_functions</span> <span class="kn">import</span> <span class="n">create_output_paths</span><span class="p">,</span> <span class="n">simulate_data</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">,</span> <span class="n">train_encoder</span>

<span class="c1"># Define list of paths</span>
<span class="n">test_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./test_outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/models&quot;</span><span class="p">]</span>


<span class="c1"># Define the tests</span>
<span class="k">def</span> <span class="nf">test_end_to_end_pipeline</span><span class="p">():</span>
    <span class="c1"># Step 1: Set up output directories</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">test_paths</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">test_paths</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> was not created.&quot;</span>

    <span class="c1"># Step 2: Generate data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./test_outputs/data/raw_data_sim.npy&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Expected output type np.ndarray&quot;</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="s2">&quot;Expected output shape (100, 50)&quot;</span>
    
    <span class="c1"># Step 3: Split data and prepare for model training</span>
    <span class="n">data_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">80</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    
    <span class="c1"># Step 4: Initialize and train the Encoder model for a few epochs</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">losses</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Limit epochs for a quick test</span>
    
    <span class="c1"># Check that the losses are recorded and decrease over epochs</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Expected 10 loss values, one for each epoch.&quot;</span>
    <span class="k">assert</span> <span class="n">losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">losses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Expected the loss to decrease over training.&quot;</span>
    

<span class="c1"># Cleanup - remove generated outputs to keep the test environment clean</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">test_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_pipeline.py
</pre></div>
</div>
</div>
</div>
<p>With that , we are already back to running out <code class="docutils literal notranslate"><span class="pre">tests</span></code>, this time including a rather complex and holistic <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">test</span></code>. Please note, that <code class="docutils literal notranslate"><span class="pre">tests</span></code> might start taking longer, as we actually running, ie <code class="docutils literal notranslate"><span class="pre">testing</span></code> quite a bite of <code class="docutils literal notranslate"><span class="pre">code</span></code>, including <code class="docutils literal notranslate"><span class="pre">model</span></code> <code class="docutils literal notranslate"><span class="pre">training</span></code> and evaluation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 9 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED                              [ 11%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED                                   [ 22%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED                 [ 33%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED                 [ 44%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED                 [ 55%]</span>
tests/test_path_sim_data_gen.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED         [ 66%]</span>
tests/test_path_sim_data_gen.py::test_simulate_data <span class=" -Color -Color-Green">PASSED               [ 77%]</span>
tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED                     [ 88%]</span>
tests/test_pipeline.py::test_end_to_end_pipeline <span class=" -Color -Color-Green">PASSED                  [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">9 passed</span><span class=" -Color -Color-Green"> in 4.33s ===============================</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="integration-testing-tips">
<h4>Integration Testing Tips<a class="headerlink" href="#integration-testing-tips" title="Link to this heading">#</a></h4>
<p>Ensure that you have a proper <code class="docutils literal notranslate"><span class="pre">Detail</span> <span class="pre">Design</span> <span class="pre">document</span></code> where <code class="docutils literal notranslate"><span class="pre">interactions</span></code> between each <code class="docutils literal notranslate"><span class="pre">unit</span></code> are clearly defined. It is difficult or impossible to perform <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code> without this information.</p>
<p>Make sure that each <code class="docutils literal notranslate"><span class="pre">unit</span></code> is <code class="docutils literal notranslate"><span class="pre">unit</span> <span class="pre">tested</span></code> and <code class="docutils literal notranslate"><span class="pre">fix</span></code> any <code class="docutils literal notranslate"><span class="pre">bugs</span></code> before you start <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">testing</span></code>. If there is a <code class="docutils literal notranslate"><span class="pre">bug</span></code> in the individual <code class="docutils literal notranslate"><span class="pre">units</span></code> then the <code class="docutils literal notranslate"><span class="pre">integration</span> <span class="pre">tests</span></code> will almost certainly <code class="docutils literal notranslate"><span class="pre">fail</span></code> even if there is no <code class="docutils literal notranslate"><span class="pre">error</span></code> in how they are <code class="docutils literal notranslate"><span class="pre">integrated</span></code>.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">mocking</span></code>/<code class="docutils literal notranslate"><span class="pre">stubs</span></code> where appropriate.</p>
</section>
</section>
<section id="system-tests">
<h3>System tests<a class="headerlink" href="#system-tests" title="Link to this heading">#</a></h3>
<p>A level of the <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">testing</span></code> process where a complete, integrated <code class="docutils literal notranslate"><span class="pre">system</span></code> is <code class="docutils literal notranslate"><span class="pre">tested</span></code>. The purpose of this <code class="docutils literal notranslate"><span class="pre">test</span></code> is to evaluate whether the <code class="docutils literal notranslate"><span class="pre">system</span></code> as a whole gives the correct outputs for given inputs.</p>
<section id="system-testing-tips">
<h4>System Testing Tips<a class="headerlink" href="#system-testing-tips" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">System</span> <span class="pre">tests</span></code>, also called <code class="docutils literal notranslate"><span class="pre">end-to-end</span> <span class="pre">tests</span></code>, run the program, well, from end to end. As such these are the most time consuming <code class="docutils literal notranslate"><span class="pre">tests</span></code> to run. Therefore you should only run these if all the <code class="docutils literal notranslate"><span class="pre">lower-level</span> <span class="pre">tests</span></code> (<code class="docutils literal notranslate"><span class="pre">smoke</span></code>, <code class="docutils literal notranslate"><span class="pre">unit</span></code>, <code class="docutils literal notranslate"><span class="pre">integration</span></code>) have already passed. If they haven’t, <code class="docutils literal notranslate"><span class="pre">fix</span></code> the <code class="docutils literal notranslate"><span class="pre">issues</span></code> they have detected first before wasting time running <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">tests</span></code>.</p>
<p>Because of their time-consuming nature it will also often be impractical to have enough <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">tests</span></code> to trace every possible route through a program, especially if there are a significant number of <code class="docutils literal notranslate"><span class="pre">conditional</span> <span class="pre">statements</span></code>. Therefore you should consider the <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">test</span></code> <code class="docutils literal notranslate"><span class="pre">cases</span></code> you run carefully and prioritise:</p>
<ul class="simple">
<li><p>the most common routes through a program</p></li>
<li><p>the most important routes for a program</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cases</span></code> that are prone to breakage due to structural problems within the program. Though ideally it’s better to just <code class="docutils literal notranslate"><span class="pre">fix</span></code> those problems, but <code class="docutils literal notranslate"><span class="pre">cases</span></code> exist where this may not be feasible.</p></li>
</ul>
<p>Because <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">tests</span></code> can be time consuming it may be impractical to <code class="docutils literal notranslate"><span class="pre">run</span></code> them very regularly (such as multiple times a day after small changes in the <code class="docutils literal notranslate"><span class="pre">code</span></code>). Therefore it can be a good idea to <code class="docutils literal notranslate"><span class="pre">run</span></code> them each night (and to <code class="docutils literal notranslate"><span class="pre">automate</span></code> this process) so that if <code class="docutils literal notranslate"><span class="pre">errors</span></code> are introduced that only <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">testing</span></code> can detect, the developer(s) will be made aware of them relatively quickly.</p>
<p>In order to run a <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">test</span></code> for our <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code>, we need to refactor the entire <code class="docutils literal notranslate"><span class="pre">script</span></code> to utilize <code class="docutils literal notranslate"><span class="pre">functions</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./emd_clust_cont_loss_sim_functions.py


<span class="c1"># Import necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">BayesianGaussianMixture</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">dump</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="c1"># Define utility function to create paths</span>
<span class="k">def</span> <span class="nf">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>

<span class="c1"># Define utility function to simulate data</span>
<span class="k">def</span> <span class="nf">simulate_data</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./outputs/data/raw_data_sim.npy&quot;</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">size</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="c1"># Define utility function to data plots</span>
<span class="k">def</span> <span class="nf">plot_data_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./outputs/graphics/data_examples.png&quot;</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data sample </span><span class="si">{</span><span class="n">sample</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>


<span class="c1"># Define class for the Encoder</span>
<span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Encoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># Define class for the MLP</span>
<span class="k">class</span> <span class="nc">MLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MLP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># Define class for the contrastive loss</span>
<span class="k">class</span> <span class="nc">ContrastiveLoss</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ContrastiveLoss</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="n">margin</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output1</span><span class="p">,</span> <span class="n">output2</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="n">euclidean_distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">output1</span> <span class="o">-</span> <span class="n">output2</span><span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">label</span><span class="p">)</span> <span class="o">*</span> <span class="n">euclidean_distance</span> <span class="o">+</span> <span class="n">label</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">-</span> <span class="n">euclidean_distance</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>


<span class="c1"># Define utility function to train the encoder</span>
<span class="k">def</span> <span class="nf">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="n">loss_function</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">encoder</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="n">momentum</span><span class="p">)</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">representations_during_training</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_function</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">data_train</span><span class="p">[:,</span> <span class="p">:</span><span class="n">encoder</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">out_features</span><span class="p">])</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

        <span class="c1"># Save representations every 1000 epochs</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">representations_during_training</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">encoder</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">losses</span><span class="p">,</span> <span class="n">representations_during_training</span>


<span class="c1"># Define utility function to plot loss</span>
<span class="k">def</span> <span class="nf">plot_loss</span><span class="p">(</span><span class="n">losses</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">losses</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch number&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Training loss&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>


<span class="c1"># Define utility function to plot encoder representations</span>
<span class="k">def</span> <span class="nf">plot_encoder_representations</span><span class="p">(</span><span class="n">representations</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">representations</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sample </span><span class="si">{</span><span class="n">sample</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>


<span class="c1"># Define utility function to apply clustering</span>
<span class="k">def</span> <span class="nf">apply_clustering</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;./outputs/models/dpgmm.joblib&#39;</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">dpgmm</span> <span class="o">=</span> <span class="n">BayesianGaussianMixture</span><span class="p">(</span>
        <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">covariance_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
        <span class="n">weight_concentration_prior_type</span><span class="o">=</span><span class="s2">&quot;dirichlet_process&quot;</span><span class="p">,</span>
        <span class="n">weight_concentration_prior</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">dpgmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dump</span><span class="p">(</span><span class="n">dpgmm</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dpgmm</span>


<span class="c1"># Define utility function to plot TSNE</span>
<span class="k">def</span> <span class="nf">plot_tsne</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">tsne_results</span> <span class="o">=</span> <span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t-SNE dim 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsne_results</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t-SNE dim 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsne_results</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;t-SNE dim 1&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;t-SNE dim 2&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;hls&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">))),</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>


<span class="c1"># Define analysis steps</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Set up output directories</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>
    <span class="n">create_output_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

    <span class="c1"># Simulate data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">()</span>

    <span class="c1"># Plot data samples</span>
    <span class="n">plot_data_samples</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Train Encoder</span>
    <span class="n">data_train</span><span class="p">,</span> <span class="n">data_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">data_train_torch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">losses</span><span class="p">,</span> <span class="n">representations_during_training</span> <span class="o">=</span> <span class="n">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train_torch</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="s1">&#39;./outputs/models/encoder.pth&#39;</span><span class="p">)</span>
    <span class="n">plot_loss</span><span class="p">(</span><span class="n">losses</span><span class="p">,</span> <span class="s2">&quot;Loss of Encoder&quot;</span><span class="p">,</span> <span class="s1">&#39;./outputs/graphics/loss_training.png&#39;</span><span class="p">)</span>

    <span class="c1"># Plot encoder representations at epoch 3000</span>
    <span class="n">plot_encoder_representations</span><span class="p">(</span><span class="n">representations_during_training</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;./outputs/graphics/data_representations_examples.png&#39;</span><span class="p">)</span>

    <span class="c1"># Apply clustering</span>
    <span class="n">dpgmm</span> <span class="o">=</span> <span class="n">apply_clustering</span><span class="p">(</span><span class="n">representations_during_training</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">cluster_assignments_train</span> <span class="o">=</span> <span class="n">dpgmm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">representations_during_training</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="c1"># t-SNE visualization of cluster assignments in training data</span>
    <span class="n">plot_tsne</span><span class="p">(</span><span class="n">representations_during_training</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">cluster_assignments_train</span><span class="p">,</span> <span class="s1">&#39;./outputs/graphics/tsne_rep_clust_train.png&#39;</span><span class="p">)</span>

    <span class="c1"># Apply trained encoder to test data</span>
    <span class="n">data_test_torch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">encoder_embeddings_test</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">data_test_torch</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># Predict clusters for test data</span>
    <span class="n">cluster_assignments_test</span> <span class="o">=</span> <span class="n">dpgmm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">encoder_embeddings_test</span><span class="p">)</span>

    <span class="c1"># t-SNE visualization of test data clusters</span>
    <span class="n">plot_tsne</span><span class="p">(</span><span class="n">encoder_embeddings_test</span><span class="p">,</span> <span class="n">cluster_assignments_test</span><span class="p">,</span> <span class="s1">&#39;./outputs/graphics/tsne_rep_clust_test.png&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ./emd_clust_cont_loss_sim_functions.py
</pre></div>
</div>
</div>
</div>
<p>Now to the second part: writing a <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">level</span> <span class="pre">test</span></code>. Here’s what it should do:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">script</span></code> runs <code class="docutils literal notranslate"><span class="pre">end-to-end</span></code> without errors, simulating a full workflow execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">directories</span></code> and <code class="docutils literal notranslate"><span class="pre">files</span></code> are created as expected, confirming each step’s success.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Model</span></code> behavior is evaluated by checking if it can produce <code class="docutils literal notranslate"><span class="pre">embeddings</span></code> and if <code class="docutils literal notranslate"><span class="pre">training</span> <span class="pre">results</span></code> in a <code class="docutils literal notranslate"><span class="pre">reduction</span></code> of <code class="docutils literal notranslate"><span class="pre">loss</span></code>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_system_analyses.py

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">emd_clust_cont_loss_sim_functions</span> <span class="kn">import</span> <span class="n">main</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">,</span> <span class="n">simulate_data</span><span class="p">,</span> <span class="n">train_encoder</span>

<span class="k">def</span> <span class="nf">test_system_workflow</span><span class="p">():</span>
    <span class="c1"># Set up paths for verification</span>
    <span class="n">output_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./outputs/models&quot;</span><span class="p">]</span>
    <span class="n">data_file</span> <span class="o">=</span> <span class="s2">&quot;./outputs/data/raw_data_sim.npy&quot;</span>
    <span class="n">plot_file</span> <span class="o">=</span> <span class="s2">&quot;./outputs/graphics/data_examples.png&quot;</span>
    <span class="n">model_file</span> <span class="o">=</span> <span class="s2">&quot;./outputs/models/encoder.pth&quot;</span>
    
    <span class="c1"># Run the main function to execute the workflow</span>
    <span class="n">main</span><span class="p">()</span>
    
    <span class="c1"># Check that output directories are created</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">output_paths</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected directory </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> to be created.&quot;</span>

    <span class="c1"># Verify data file existence and format</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">data_file</span><span class="p">),</span> <span class="s2">&quot;Expected data file not found.&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Data file is not in the expected .npy format.&quot;</span>
    
    <span class="c1"># Verify the plot file is created</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">plot_file</span><span class="p">),</span> <span class="s2">&quot;Expected plot file not found.&quot;</span>

    <span class="c1"># Verify the model file is created</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">model_file</span><span class="p">),</span> <span class="s2">&quot;Expected model file not found.&quot;</span>
    
    <span class="c1"># Step 1: Load and check model</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_file</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">),</span> <span class="s2">&quot;The loaded model is not an instance of the Encoder class.&quot;</span>
    
    <span class="c1"># Step 2: Evaluate model with sample data</span>
    <span class="c1"># Use a small subset of the data to generate embeddings and verify the output shape</span>
    <span class="n">data_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>  <span class="c1"># Take a sample of 10 for testing</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>
    
    <span class="c1"># Check the output embeddings shape</span>
    <span class="n">expected_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">encoder</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">out_features</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">expected_shape</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Expected embeddings shape </span><span class="si">{</span><span class="n">expected_shape</span><span class="si">}</span><span class="s2">, but got </span><span class="si">{</span><span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="c1"># Step 3: Check if training reduces loss over epochs</span>
    <span class="c1"># Train the model for a small number of epochs and confirm that loss decreases</span>
    <span class="n">data_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">80</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
    <span class="n">initial_loss</span><span class="p">,</span> <span class="n">final_loss</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># Reinitialize the encoder for testing</span>
    <span class="n">losses</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Train for a few epochs for quick testing</span>
    
    <span class="c1"># Capture initial and final losses</span>
    <span class="n">initial_loss</span><span class="p">,</span> <span class="n">final_loss</span> <span class="o">=</span> <span class="n">losses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Verify that the final loss is lower than the initial loss</span>
    <span class="k">assert</span> <span class="n">final_loss</span> <span class="o">&lt;</span> <span class="n">initial_loss</span><span class="p">,</span> <span class="s2">&quot;Expected final loss to be lower than initial loss, indicating training progress.&quot;</span>

    <span class="c1"># Cleanup - remove generated outputs to keep the test environment clean</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">output_paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_system_analyses.py
</pre></div>
</div>
</div>
</div>
<p>The moment of truth is here: we run the <code class="docutils literal notranslate"><span class="pre">tests</span></code> as usual and will grab something to drink/snack, as this might take a while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 10 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                              [ 10%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                                   [ 20%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 30%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 40%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 50%]</span>
tests/test_path_sim_data_gen.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">         [ 60%]</span>
tests/test_path_sim_data_gen.py::test_simulate_data <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">               [ 70%]</span>
tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                     [ 80%]</span>
tests/test_pipeline.py::test_end_to_end_pipeline <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                  [ 90%]</span>
tests/test_system_analyses.py::test_system_workflow <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">               [100%]</span>

<span class=" -Color -Color-Yellow">=============================== warnings summary ===============================</span>
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/utils.py:11
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/utils.py:11: DeprecationWarning: 
  Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
  (to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
  but was not found to be installed on your system.
  If this would cause problems for you,
  please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
          
    import pandas as pd

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/rcmod.py:82
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/rcmod.py:82: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(mpl.__version__) &gt;= &quot;3.0&quot;:

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/setuptools/_distutils/version.py:346
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/setuptools/_distutils/version.py:346: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    other = LooseVersion(other)

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582: MatplotlibDeprecationWarning: The register_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps.register(name)`` instead.
    mpl_cm.register_cmap(_name, _cmap)

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583: MatplotlibDeprecationWarning: The register_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps.register(name)`` instead.
    mpl_cm.register_cmap(_name + &quot;_r&quot;, _cmap_r)

tests/test_system_analyses.py::test_system_workflow
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/_decorators.py:36: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
    warnings.warn(

tests/test_system_analyses.py::test_system_workflow
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/threadpoolctl.py:1010: RuntimeWarning: 
  Found Intel OpenMP (&#39;libiomp&#39;) and LLVM OpenMP (&#39;libomp&#39;) loaded at
  the same time. Both libraries are known to be incompatible and this
  can cause random crashes or deadlocks on Linux when loaded in the
  same Python program.
  Using threadpoolctl may cause crashes or deadlocks. For more
  information and possible workarounds, please see
      https://github.com/joblib/threadpoolctl/blob/master/multiple_openmp.md
  
    warnings.warn(msg, RuntimeWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
<span class=" -Color -Color-Yellow">======================= </span><span class=" -Color -Color-Green">10 passed</span>, <span class=" -Color -Color-Bold -Color-Bold-Yellow">17 warnings</span><span class=" -Color -Color-Yellow"> in 16.15s =======================</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="acceptance-and-regression-tests">
<h3>Acceptance and regression tests<a class="headerlink" href="#acceptance-and-regression-tests" title="Link to this heading">#</a></h3>
<p>A level of the <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">testing</span> <span class="pre">process</span></code> where a <code class="docutils literal notranslate"><span class="pre">system</span></code> is <code class="docutils literal notranslate"><span class="pre">tested</span></code> for acceptability. The purpose of this <code class="docutils literal notranslate"><span class="pre">test</span></code> is to evaluate the <code class="docutils literal notranslate"><span class="pre">system</span></code>’s compliance with the <code class="docutils literal notranslate"><span class="pre">project</span></code> requirements and assess whether it is acceptable for the purpose.</p>
<section id="acceptance-testing">
<h4>Acceptance testing<a class="headerlink" href="#acceptance-testing" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Acceptance</span> <span class="pre">tests</span></code> are one of the last <code class="docutils literal notranslate"><span class="pre">tests</span> <span class="pre">types</span></code> that are performed on <code class="docutils literal notranslate"><span class="pre">software</span></code> prior to delivery. <code class="docutils literal notranslate"><span class="pre">Acceptance</span> <span class="pre">testing</span></code> is used to determine whether a piece of <code class="docutils literal notranslate"><span class="pre">software</span></code> satisfies all of the requirements from user’s perspective. Does this piece of <code class="docutils literal notranslate"><span class="pre">software</span></code> do what it needs to do? These <code class="docutils literal notranslate"><span class="pre">tests</span></code> are sometimes built against the original specification.</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">research</span> <span class="pre">software</span></code> is typically written by the researcher that will use it (or at least with significant <code class="docutils literal notranslate"><span class="pre">input</span></code> from them) <code class="docutils literal notranslate"><span class="pre">acceptance</span> <span class="pre">tests</span></code> may not be necessary.</p>
</section>
<section id="regression-testing">
<h4>Regression testing<a class="headerlink" href="#regression-testing" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Regression</span> <span class="pre">testing</span></code> checks for unintended changes by comparing new test results to previous ones, ensuring updates don’t break the <code class="docutils literal notranslate"><span class="pre">software</span></code>. It’s critical because even unrelated <code class="docutils literal notranslate"><span class="pre">code</span></code> changes can cause issues. Suitable for all <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">levels</span></code>, it’s vital in <code class="docutils literal notranslate"><span class="pre">system</span> <span class="pre">testing</span></code> and can automate tedious manual <code class="docutils literal notranslate"><span class="pre">checks</span></code>. <code class="docutils literal notranslate"><span class="pre">Tests</span></code> are created by recording <code class="docutils literal notranslate"><span class="pre">outputs</span></code> for specific <code class="docutils literal notranslate"><span class="pre">inputs</span></code>, then <code class="docutils literal notranslate"><span class="pre">retesting</span></code> and comparing <code class="docutils literal notranslate"><span class="pre">results</span></code> to detect discrepancies. Essential for team projects, it’s also crucial for solo work to catch self-introduced <code class="docutils literal notranslate"><span class="pre">errors</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Regression</span> <span class="pre">testing</span></code> approaches differ in their focus. Common examples include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Bug</span> <span class="pre">regression</span></code>: retest a specific <code class="docutils literal notranslate"><span class="pre">bug</span></code> that has been allegedly <code class="docutils literal notranslate"><span class="pre">fixed</span></code></p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Old</span> <span class="pre">fix</span> <span class="pre">regression</span> <span class="pre">testing</span></code>: retest several old <code class="docutils literal notranslate"><span class="pre">bugs</span></code> that were <code class="docutils literal notranslate"><span class="pre">fixed</span></code>, to see if they are back. (This is the classical notion of <code class="docutils literal notranslate"><span class="pre">regression</span></code>: the program has regressed to a bad state.)</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">General</span> <span class="pre">functional</span> <span class="pre">regression</span></code>: <code class="docutils literal notranslate"><span class="pre">retest</span></code> the project broadly, including areas that worked before, to see whether more recent changes have destabilized working <code class="docutils literal notranslate"><span class="pre">code</span></code>.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Conversion</span> <span class="pre">or</span> <span class="pre">port</span> <span class="pre">testing</span></code>: the program is <code class="docutils literal notranslate"><span class="pre">ported</span></code> to a new platform and a <code class="docutils literal notranslate"><span class="pre">regression</span> <span class="pre">test</span> <span class="pre">suite</span></code> is run to determine whether the <code class="docutils literal notranslate"><span class="pre">port</span></code> was successful.</p></li>
</ul>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Configuration</span> <span class="pre">testing</span></code>: the <code class="docutils literal notranslate"><span class="pre">program</span></code> is <code class="docutils literal notranslate"><span class="pre">run</span></code> with a new <code class="docutils literal notranslate"><span class="pre">device</span></code> or on a new <code class="docutils literal notranslate"><span class="pre">version</span></code> of the <code class="docutils literal notranslate"><span class="pre">operating</span> <span class="pre">system</span></code> or in conjunction with a new application. This is like <code class="docutils literal notranslate"><span class="pre">port</span> <span class="pre">testing</span></code> except that the underlying <code class="docutils literal notranslate"><span class="pre">code</span></code> hasn’t been changed–only the external <code class="docutils literal notranslate"><span class="pre">components</span></code> that the <code class="docutils literal notranslate"><span class="pre">software</span></code> under <code class="docutils literal notranslate"><span class="pre">test</span></code> must interact with.</p></li>
</ul>
<p>As we already refactored the entire <code class="docutils literal notranslate"><span class="pre">code</span></code>/<code class="docutils literal notranslate"><span class="pre">analyses</span></code> to utilize ``functions<code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">we</span> <span class="pre">can</span> <span class="pre">start</span> <span class="pre">writing</span> <span class="pre">a</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">regression</span> </code>tests<code class="docutils literal notranslate"><span class="pre">right</span> <span class="pre">away.</span> <span class="pre">In</span> <span class="pre">more</span> <span class="pre">detail</span> <span class="pre">we</span> <span class="pre">will</span> <span class="pre">ensure</span> <span class="pre">that</span> <span class="pre">the</span> <span class="pre">generated</span></code>data<code class="docutils literal notranslate"><span class="pre">,</span> </code>model training<code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">and</span> </code>model output` remain consistent:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Check</span> <span class="pre">Data</span> <span class="pre">Consistency</span></code>: Verify that the <code class="docutils literal notranslate"><span class="pre">data</span></code> generated by <code class="docutils literal notranslate"><span class="pre">simulate_data</span></code> has a <code class="docutils literal notranslate"><span class="pre">specific</span> <span class="pre">shape</span></code> and <code class="docutils literal notranslate"><span class="pre">sample</span> <span class="pre">values</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Check</span> <span class="pre">Loss</span> <span class="pre">Consistency</span></code>: <code class="docutils literal notranslate"><span class="pre">Train</span></code> the <code class="docutils literal notranslate"><span class="pre">Encoder</span></code> for a few <code class="docutils literal notranslate"><span class="pre">epochs</span></code> and confirm that the final <code class="docutils literal notranslate"><span class="pre">loss</span></code> falls within an <code class="docutils literal notranslate"><span class="pre">expected</span> <span class="pre">range</span></code>, ensuring the <code class="docutils literal notranslate"><span class="pre">model</span></code> <code class="docutils literal notranslate"><span class="pre">trains</span></code> as expected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Check</span> <span class="pre">Model</span> <span class="pre">Output</span> <span class="pre">Consistency</span></code>: Confirm that the output <code class="docutils literal notranslate"><span class="pre">embeddings</span></code> have the correct <code class="docutils literal notranslate"><span class="pre">shape</span></code> and that specific <code class="docutils literal notranslate"><span class="pre">values</span></code> in the output are as expected.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ./tests/test_regeression_analyses.py

<span class="c1"># Import all necessary modules</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">emd_clust_cont_loss_sim_functions</span> <span class="kn">import</span> <span class="n">simulate_data</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">,</span> <span class="n">train_encoder</span>


<span class="c1"># Define list of paths</span>
<span class="n">test_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./test_outputs/&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/data&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/graphics&quot;</span><span class="p">,</span> <span class="s2">&quot;./test_outputs/models&quot;</span><span class="p">]</span>


<span class="c1"># Define regression test</span>
<span class="k">def</span> <span class="nf">test_regression_workflow</span><span class="p">():</span>
    <span class="c1"># Part 1: Data Consistency Check</span>
    <span class="c1"># Generate test data and check shape and sample values</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">simulate_data</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;./test_outputs/data/raw_data_sim.npy&quot;</span><span class="p">)</span>
      
    <span class="c1"># Verify data shape</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;Data shape mismatch.&quot;</span>

    <span class="c1"># Part 2: Loss Consistency Check</span>
    <span class="c1"># Initialize the encoder and train it briefly, then check final loss</span>
    <span class="n">input_dim</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">data_train</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>

    <span class="c1"># Train the encoder for a few epochs</span>
    <span class="n">losses</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">data_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Check that the final loss is within the expected range</span>
    <span class="n">final_loss</span> <span class="o">=</span> <span class="n">losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="mf">0.01</span> <span class="o">&lt;</span> <span class="n">final_loss</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Final loss </span><span class="si">{</span><span class="n">final_loss</span><span class="si">}</span><span class="s2"> is outside the expected range (0.01, 2.0).&quot;</span>

    <span class="c1"># Part 3: Model Output Consistency Check</span>
    <span class="c1"># Generate embeddings and verify their shape and sample values</span>
    <span class="n">data_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>  <span class="c1"># Take a sample of 10 rows for testing</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">data_sample</span><span class="p">)</span>

    <span class="c1"># Verify output shape</span>
    <span class="k">assert</span> <span class="n">embeddings</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="s2">&quot;Embedding shape mismatch.&quot;</span>

    <span class="c1"># Expected embedding sample values (replace with known values for regression testing)</span>
    <span class="n">expected_embedding_sample</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Capture this once and use it as reference</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[:</span><span class="mi">5</span><span class="p">],</span> <span class="n">expected_embedding_sample</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                   <span class="n">err_msg</span><span class="o">=</span><span class="s2">&quot;Embedding does not match expected sample values.&quot;</span><span class="p">)</span>

<span class="c1"># Cleanup - remove generated outputs to keep the test environment clean</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">test_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Writing ./tests/test_regeression_analyses.py
</pre></div>
</div>
</div>
</div>
<p>For the last time in this session, let’s run the <code class="docutils literal notranslate"><span class="pre">tests</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
pytest
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /Users/peerherholz/anaconda3/envs/course_name/bin/python3.1
cachedir: .pytest_cache
rootdir: /Users/peerherholz/google_drive/GitHub/Clean_Repro_Code_Neuromatch/workshop/materials/code_form_test_CI
configfile: pytest.ini
testpaths: ./tests
plugins: anyio-4.2.0
<span class=" -Color -Color-Bold">collecting ... </span>collected 11 items

tests/test_addition.py::test_example <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                              [  9%]</span>
tests/test_fixture.py::test_sum <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                                   [ 18%]</span>
tests/test_parameterized.py::test_addition[1-1-2] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 27%]</span>
tests/test_parameterized.py::test_addition[2-3-5] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 36%]</span>
tests/test_parameterized.py::test_addition[3-3-6] <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 45%]</span>
tests/test_path_sim_data_gen.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">         [ 54%]</span>
tests/test_path_sim_data_gen.py::test_simulate_data <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">               [ 63%]</span>
tests/test_paths.py::test_create_output_paths <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                     [ 72%]</span>
tests/test_pipeline.py::test_end_to_end_pipeline <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                  [ 81%]</span>
tests/test_regeression_analyses.py::test_regression_workflow <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">      [ 90%]</span>
tests/test_system_analyses.py::test_system_workflow <span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">               [100%]</span>

<span class=" -Color -Color-Yellow">=============================== warnings summary ===============================</span>
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/utils.py:11
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/utils.py:11: DeprecationWarning: 
  Pyarrow will become a required dependency of pandas in the next major release of pandas (pandas 3.0),
  (to allow more performant data types, such as the Arrow string type, and better interoperability with other libraries)
  but was not found to be installed on your system.
  If this would cause problems for you,
  please provide us feedback at https://github.com/pandas-dev/pandas/issues/54466
          
    import pandas as pd

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/rcmod.py:82
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/rcmod.py:82: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(mpl.__version__) &gt;= &quot;3.0&quot;:

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/setuptools/_distutils/version.py:346
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/setuptools/_distutils/version.py:346: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    other = LooseVersion(other)

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1582: MatplotlibDeprecationWarning: The register_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps.register(name)`` instead.
    mpl_cm.register_cmap(_name, _cmap)

../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
../../../../../../anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/cm.py:1583: MatplotlibDeprecationWarning: The register_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps.register(name)`` instead.
    mpl_cm.register_cmap(_name + &quot;_r&quot;, _cmap_r)

tests/test_system_analyses.py::test_system_workflow
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/seaborn/_decorators.py:36: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
    warnings.warn(

tests/test_system_analyses.py::test_system_workflow
  /Users/peerherholz/anaconda3/envs/course_name/lib/python3.10/site-packages/threadpoolctl.py:1010: RuntimeWarning: 
  Found Intel OpenMP (&#39;libiomp&#39;) and LLVM OpenMP (&#39;libomp&#39;) loaded at
  the same time. Both libraries are known to be incompatible and this
  can cause random crashes or deadlocks on Linux when loaded in the
  same Python program.
  Using threadpoolctl may cause crashes or deadlocks. For more
  information and possible workarounds, please see
      https://github.com/joblib/threadpoolctl/blob/master/multiple_openmp.md
  
    warnings.warn(msg, RuntimeWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
<span class=" -Color -Color-Yellow">======================= </span><span class=" -Color -Color-Green">11 passed</span>, <span class=" -Color -Color-Bold -Color-Bold-Yellow">17 warnings</span><span class=" -Color -Color-Yellow"> in 16.76s =======================</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion">
<h2>Conclusion:<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>Embracing <code class="docutils literal notranslate"><span class="pre">testing</span></code> and <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">frameworks</span></code> like <code class="docutils literal notranslate"><span class="pre">pytest</span></code> and incorporating a comprehensive <code class="docutils literal notranslate"><span class="pre">testing</span> <span class="pre">strategy</span></code> are essential steps towards achieving high-quality software development. These <code class="docutils literal notranslate"><span class="pre">frameworks</span></code> not only <code class="docutils literal notranslate"><span class="pre">automate</span></code> the <code class="docutils literal notranslate"><span class="pre">testing</span></code> process but also provide a structured approach to addressing a wide spectrum of <code class="docutils literal notranslate"><span class="pre">testing</span></code> requirements. By leveraging their capabilities, <code class="docutils literal notranslate"><span class="pre">researchers</span></code> and <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">developers</span></code> can ensure thorough <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">coverage</span></code>, streamline <code class="docutils literal notranslate"><span class="pre">debugging</span></code>, and maintain high standards of <code class="docutils literal notranslate"><span class="pre">software</span> <span class="pre">quality</span></code> and `performance``.</p>
<div class="admonition-task-for-y-all admonition">
<p class="admonition-title">Task for y’all!</p>
<p>Remember our <code class="docutils literal notranslate"><span class="pre">script</span></code> from the beginning? You already went through it a couple of times and brought to <code class="docutils literal notranslate"><span class="pre">code</span></code> (get it?). Now, we would like to add some <code class="docutils literal notranslate"><span class="pre">tests</span></code> for our <code class="docutils literal notranslate"><span class="pre">script</span></code> to ensure its functionality.</p>
<p>You have 40 min.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./materials/code_form_test_CI"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="code_formatting.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Code formatting, styling and linting</p>
      </div>
    </a>
    <a class="right-next"
       href="../../prerequisites.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Course prerequisites</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mistakes-made-while-coding">Mistakes made while coding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-instabilities-and-changes">Code instabilities and changes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-time-and-effort">save time and effort</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#long-term-confidence">long-term confidence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#peace-of-mind">peace of mind</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#better-code-from-the-start">better code from the start</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#research-software">Research software</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#write-tests-any-tests">Write Tests - Any Tests!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-tests">Run the tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#consider-how-long-it-takes-your-tests-to-run">Consider how long it takes your tests to run</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#document-the-tests-and-how-to-run-them">Document the tests and how to run them</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-realistic-cases">Test Realistic Cases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-a-testing-framework">Use a Testing Framework</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coverage">Coverage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-test-doubles-stubs-mocking-where-appropriate">Use test doubles/stubs/mocking where appropriate</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-testing-the-basics">Code Testing - the basics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assert-a-test-s-best-friend">Assert - a test’s best friend</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#syntax">Syntax</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A simple example</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-in-testing">Usage in Testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-testing">Runtime testing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-of-runtime-testing">Advantages of runtime testing:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#disadvantages-of-runtime-testing">Disadvantages of runtime testing:</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-frameworks">Testing frameworks</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-features-of-testing-frameworks">Key Features of Testing Frameworks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-for-using-testing-frameworks">Setup for using testing frameworks</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pytest"><code class="docutils literal notranslate"><span class="pre">pytest</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#running-pytest">Running pytest</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-basic-tests-with-pytest">Writing Basic Tests with <code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#using-fixtures-for-setup-and-teardown">Using Fixtures for Setup and Teardown</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parameterizing-tests">Parameterizing Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-testing-different-types-of-tests">Code testing - different types of tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#smoke-tests">Smoke tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests">Unit tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-testing-tips">Unit Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-tests">Integration tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-testing-approaches">Integration Testing Approaches</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-testing-tips">Integration Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#system-tests">System tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#system-testing-tips">System Testing Tips</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acceptance-and-regression-tests">Acceptance and regression tests</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acceptance-testing">Acceptance testing</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-testing">Regression testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion:</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Neuromatch Impact Scholars team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024-.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>